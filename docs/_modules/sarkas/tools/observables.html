  

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>sarkas.tools.observables &mdash; Sarkas 0.1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html">
          

          
            
            <img src="../../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../why_sarkas/why_sarkas.html">Why Sarkas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart/Quickstart.html">Quickstart</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/input_file.html">Input File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/Pre_Simulation_Testing.html">Pre Simulation Testing</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/H-He_Mixture.html">H-He Mixture Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/QSP_Tutorial.html">Quantum Statistical Potential Simulation</a></li>
</ul>
<p class="caption"><span class="caption-text">Theoretical Background:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../theory/potentials.html">Potentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../theory/thermostats.html">Thermostats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../theory/PPPM.html">Particle-Particle Particle-Mesh Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../theory/force_error.html">Force Error</a></li>
</ul>
<p class="caption"><span class="caption-text">Source Code:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/modules.html">sarkas</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Sarkas</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>sarkas.tools.observables</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for sarkas.tools.observables</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module for calculating physical quantities from Sarkas checkpoints.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">IPython</span> <span class="kn">import</span> <span class="n">get_ipython</span>

<span class="k">if</span> <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;ZMQInteractiveShell&#39;</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm_notebook</span> <span class="k">as</span> <span class="n">tqdm</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">njit</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">matplotlib.gridspec</span> <span class="kn">import</span> <span class="n">GridSpec</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">UNITS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;Energy&quot;</span><span class="p">:</span> <span class="s1">&#39;J&#39;</span><span class="p">,</span>
     <span class="s2">&quot;Time&quot;</span><span class="p">:</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span>
     <span class="s2">&quot;Length&quot;</span><span class="p">:</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span>
     <span class="s2">&quot;Charge&quot;</span><span class="p">:</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span>
     <span class="s2">&quot;Temperature&quot;</span><span class="p">:</span> <span class="s1">&#39;K&#39;</span><span class="p">,</span>
     <span class="s2">&quot;ElectronVolt&quot;</span><span class="p">:</span> <span class="s1">&#39;eV&#39;</span><span class="p">,</span>
     <span class="s2">&quot;Mass&quot;</span><span class="p">:</span> <span class="s1">&#39;kg&#39;</span><span class="p">,</span>
     <span class="s2">&quot;Magnetic Field&quot;</span><span class="p">:</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span>
     <span class="s2">&quot;Current&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span>
     <span class="s2">&quot;Power&quot;</span><span class="p">:</span> <span class="s2">&quot;erg/s&quot;</span><span class="p">,</span>
     <span class="s2">&quot;Pressure&quot;</span><span class="p">:</span> <span class="s2">&quot;Pa&quot;</span><span class="p">,</span>
     <span class="s2">&quot;Conductivity&quot;</span><span class="p">:</span> <span class="s2">&quot;S/m&quot;</span><span class="p">,</span>
     <span class="s2">&quot;Diffusion&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;m$^2$/s&quot;</span><span class="p">,</span>
     <span class="s2">&quot;Viscosity&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;Pa s&quot;</span><span class="p">,</span>
     <span class="s2">&quot;none&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;Energy&quot;</span><span class="p">:</span> <span class="s1">&#39;erg&#39;</span><span class="p">,</span>
     <span class="s2">&quot;Time&quot;</span><span class="p">:</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span>
     <span class="s2">&quot;Length&quot;</span><span class="p">:</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span>
     <span class="s2">&quot;Charge&quot;</span><span class="p">:</span> <span class="s1">&#39;esu&#39;</span><span class="p">,</span>
     <span class="s2">&quot;Temperature&quot;</span><span class="p">:</span> <span class="s1">&#39;K&#39;</span><span class="p">,</span>
     <span class="s2">&quot;ElectronVolt&quot;</span><span class="p">:</span> <span class="s1">&#39;eV&#39;</span><span class="p">,</span>
     <span class="s2">&quot;Mass&quot;</span><span class="p">:</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span>
     <span class="s2">&quot;Magnetic Field&quot;</span><span class="p">:</span> <span class="s1">&#39;G&#39;</span><span class="p">,</span>
     <span class="s2">&quot;Current&quot;</span><span class="p">:</span> <span class="s2">&quot;esu/s&quot;</span><span class="p">,</span>
     <span class="s2">&quot;Power&quot;</span><span class="p">:</span> <span class="s2">&quot;erg/s&quot;</span><span class="p">,</span>
     <span class="s2">&quot;Pressure&quot;</span><span class="p">:</span> <span class="s2">&quot;Ba&quot;</span><span class="p">,</span>
     <span class="s2">&quot;Conductivity&quot;</span><span class="p">:</span> <span class="s2">&quot;mho/cm&quot;</span><span class="p">,</span>
     <span class="s2">&quot;Diffusion&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;cm$^2$/s&quot;</span><span class="p">,</span>
     <span class="s2">&quot;Viscosity&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;Ba s&quot;</span><span class="p">,</span>
     <span class="s2">&quot;none&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">PREFIXES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Y&quot;</span><span class="p">:</span> <span class="mf">1e24</span><span class="p">,</span>
    <span class="s2">&quot;Z&quot;</span><span class="p">:</span> <span class="mf">1e21</span><span class="p">,</span>
    <span class="s2">&quot;E&quot;</span><span class="p">:</span> <span class="mf">1e18</span><span class="p">,</span>
    <span class="s2">&quot;P&quot;</span><span class="p">:</span> <span class="mf">1e15</span><span class="p">,</span>
    <span class="s2">&quot;T&quot;</span><span class="p">:</span> <span class="mf">1e12</span><span class="p">,</span>
    <span class="s2">&quot;G&quot;</span><span class="p">:</span> <span class="mf">1e9</span><span class="p">,</span>
    <span class="s2">&quot;M&quot;</span><span class="p">:</span> <span class="mf">1e6</span><span class="p">,</span>
    <span class="s2">&quot;k&quot;</span><span class="p">:</span> <span class="mf">1e3</span><span class="p">,</span>
    <span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="mf">1e0</span><span class="p">,</span>
    <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="mf">1.0e-2</span><span class="p">,</span>
    <span class="s2">&quot;m&quot;</span><span class="p">:</span> <span class="mf">1.0e-3</span><span class="p">,</span>
    <span class="sa">r</span><span class="s2">&quot;$\mu$&quot;</span><span class="p">:</span> <span class="mf">1.0e-6</span><span class="p">,</span>
    <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="mf">1.0e-9</span><span class="p">,</span>
    <span class="s2">&quot;p&quot;</span><span class="p">:</span> <span class="mf">1.0e-12</span><span class="p">,</span>
    <span class="s2">&quot;f&quot;</span><span class="p">:</span> <span class="mf">1.0e-15</span><span class="p">,</span>
    <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mf">1.0e-18</span><span class="p">,</span>
    <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="mf">1.0e-21</span><span class="p">,</span>
    <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mf">1.0e-24</span>
<span class="p">}</span>


<div class="viewcode-block" id="Observable"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.Observable">[docs]</a><span class="k">class</span> <span class="nc">Observable</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parent class of all the observables.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    dataframe : pandas.DataFrame</span>
<span class="sd">        Dataframe containing the computed data.</span>

<span class="sd">    dataframe_longitudinal : pandas.DataFrame</span>
<span class="sd">        Dataframe containing the longitudinal part of the computed observable.</span>

<span class="sd">    dataframe_transverse : pandas.DataFrame</span>
<span class="sd">        Dataframe containing the transverse part of the computed observable.</span>

<span class="sd">    no_ka_harmonics : list</span>
<span class="sd">        Maximum number of :math:`\mathbf{k}` harmonics to calculatealong each dimension.</span>

<span class="sd">    phase : str</span>
<span class="sd">        Phase to analyze.</span>

<span class="sd">    prod_no_dumps : int</span>
<span class="sd">        Number of production phase checkpoints. Calculated from the number of files in the Production directory.</span>

<span class="sd">    eq_no_dumps : int</span>
<span class="sd">        Number of equilibration phase checkpoints. Calculated from the number of files in the Equilibration directory.</span>

<span class="sd">    no_dumps : int</span>
<span class="sd">        Number of simulation&#39;s checkpoints. Calculated from the number of files in the phase folder.</span>

<span class="sd">    dump_dir : str</span>
<span class="sd">        Path to correct dump directory.</span>

<span class="sd">    dump_step : int</span>
<span class="sd">        Correct step interval.</span>
<span class="sd">        It is either ``sarkas.base.Parameters.prod_dump_step`` or ``sarkas.base.Parameters.eq_dump_step``.</span>

<span class="sd">    species : list</span>
<span class="sd">        List of ``sarkas.base.Species`` indicating simulation&#39;s species.</span>

<span class="sd">    no_obs : int</span>
<span class="sd">        Number of independent binary observable quantities.</span>
<span class="sd">        It is calculated as :math:`N_s (N_s + 1) / 2` where :math: `N_s` is the number of species.</span>

<span class="sd">    k_file : str</span>
<span class="sd">        Path to the npz file storing the :math:`k` vector values.</span>

<span class="sd">    nkt_file : str</span>
<span class="sd">        Path to the npy file containing the Fourier transform of density fluctuations. :math:`n(\mathbf k, t)`.</span>

<span class="sd">    vkt_file : str</span>
<span class="sd">        Path to the npz file containing the Fourier transform of velocity fluctuations. :math:`\mathbf v(\mathbf k, t)`.</span>

<span class="sd">    k_space_dir : str</span>
<span class="sd">        Directory where :math:`\mathbf {k}` data is stored.</span>

<span class="sd">    filename_csv_longitudinal : str</span>
<span class="sd">        Path to to the csv file containing the longitudinal part of the computed observable.</span>

<span class="sd">    filename_csv_transverse : str</span>
<span class="sd">        Path to the csv file containing the transverse part of the computed observable.</span>

<span class="sd">    saving_dir : str</span>
<span class="sd">        Path to the directory where computed data is stored.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe_longitudinal</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe_transverse</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename_csv</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename_csv_longitudinal</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename_csv_transverse</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sortedDict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span>
        <span class="n">disp</span> <span class="o">=</span> <span class="s1">&#39;Observable( &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">sortedDict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;dataframe&#39;</span><span class="p">,</span> <span class="s1">&#39;dataframe_longitudinal&#39;</span><span class="p">,</span> <span class="s1">&#39;dataframe_transverse&#39;</span><span class="p">]:</span>
                <span class="n">disp</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="si">{}</span><span class="s2"> : </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">disp</span> <span class="o">+=</span> <span class="s1">&#39;)&#39;</span>
        <span class="k">return</span> <span class="n">disp</span>

<div class="viewcode-block" id="Observable.from_dict"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.Observable.from_dict">[docs]</a>    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update attributes from input dictionary.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        input_dict: dict</span>
<span class="sd">            Dictionary to be copied.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">input_dict</span><span class="p">)</span></div>

<div class="viewcode-block" id="Observable.setup_init"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.Observable.setup_init">[docs]</a>    <span class="k">def</span> <span class="nf">setup_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">phase</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>

        <span class="c1"># Create the lists of k vectors</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;no_ka_harmonics&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_ka_harmonics</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">no_ka_harmonics</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_ka_harmonics</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">no_ka_harmonics</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">k_space_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">postprocessing_dir</span><span class="p">,</span> <span class="s2">&quot;k_space_data&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_space_dir</span><span class="p">,</span> <span class="s2">&quot;k_arrays.npz&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nkt_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_space_dir</span><span class="p">,</span> <span class="s2">&quot;nkt&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vkt_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_space_dir</span><span class="p">,</span> <span class="s2">&quot;vkt&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">no_obs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_species</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_species</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prod_no_dumps</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prod_dump_dir</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eq_no_dumps</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eq_dump_dir</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">phase</span> <span class="o">==</span> <span class="s1">&#39;equilibration&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">no_dumps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_no_dumps</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dump_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_dump_dir</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_dump_step</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">no_steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">equilibration_steps</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">no_dumps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prod_no_dumps</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dump_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prod_dump_dir</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prod_dump_step</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">no_steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">production_steps</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;no_slices&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">no_slices</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice_steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_dumps</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_slices</span><span class="p">)</span></div>

<div class="viewcode-block" id="Observable.parse"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.Observable.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Grab the pandas dataframe from the saved csv file. If file does not exist call ``compute``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;CurrentCorrelationFunction&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataframe_longitudinal</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_csv_longitudinal</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataframe_transverse</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_csv_transverse</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">k_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_file</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">k_list</span> <span class="o">=</span> <span class="n">k_data</span><span class="p">[</span><span class="s2">&quot;k_list&quot;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">k_counts</span> <span class="o">=</span> <span class="n">k_data</span><span class="p">[</span><span class="s2">&quot;k_counts&quot;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ka_values</span> <span class="o">=</span> <span class="n">k_data</span><span class="p">[</span><span class="s2">&quot;ka_values&quot;</span><span class="p">]</span>

            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">File </span><span class="si">{}</span><span class="s2"> not found!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_csv_longitudinal</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">File </span><span class="si">{}</span><span class="s2"> not found!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_csv_transverse</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Computing Observable now ...&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">[</span><span class="o">-</span><span class="mi">15</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;StructureFactor&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_csv</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">k_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_file</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">k_list</span> <span class="o">=</span> <span class="n">k_data</span><span class="p">[</span><span class="s2">&quot;k_list&quot;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">k_counts</span> <span class="o">=</span> <span class="n">k_data</span><span class="p">[</span><span class="s2">&quot;k_counts&quot;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ka_values</span> <span class="o">=</span> <span class="n">k_data</span><span class="p">[</span><span class="s2">&quot;ka_values&quot;</span><span class="p">]</span>

            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">File </span><span class="si">{}</span><span class="s2"> not found!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_csv</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Computing Observable now ...&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_csv</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">File </span><span class="si">{}</span><span class="s2"> not found!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_csv</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Computing Observable now ...&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span></div>

<div class="viewcode-block" id="Observable.plot"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.Observable.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">normalization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">acf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">longitudinal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the observable by calling the pandas.DataFrame.plot() function and save the figure.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        longitudinal : bool</span>
<span class="sd">            Flag for longitudinal plot in case of CurrenCurrelationFunction</span>

<span class="sd">        acf : bool</span>
<span class="sd">            Flag for renormalizing the autocorrelation functions. Default= False</span>

<span class="sd">        figname : str</span>
<span class="sd">            Name with which to save the file. It automaticall saves it in the correct directory.</span>

<span class="sd">        normalization: float</span>
<span class="sd">            Factor by which to divide the distance array.</span>

<span class="sd">        show : bool</span>
<span class="sd">            Flag for prompting the plot to screen. Default=False</span>

<span class="sd">        **kwargs :</span>
<span class="sd">            Options to pass to matplotlib plotting method.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        axes_handle : matplotlib.axes.Axes</span>
<span class="sd">            Axes. See `pandas` documentation for more info</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Grab the data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>
        <span class="c1"># Make a copy of the dataframe for plotting</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">!=</span> <span class="s1">&#39;CurrentCorrelationFunction&#39;</span><span class="p">:</span>
            <span class="n">plot_dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">longitudinal</span><span class="p">:</span>
            <span class="n">plot_dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe_longitudinal</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plot_dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe_transverse</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">normalization</span><span class="p">:</span>
            <span class="n">plot_dataframe</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/=</span> <span class="n">normalization</span>

        <span class="c1"># Autocorrelation function renormalization</span>
        <span class="k">if</span> <span class="n">acf</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">plot_dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">plot_dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">/=</span> <span class="n">plot_dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;logx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;StaticStructureFactor&#39;</span><span class="p">:</span>
            <span class="n">errorbars</span> <span class="o">=</span> <span class="n">plot_dataframe</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">col</span><span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;Errorbar&#39;</span><span class="p">:</span>
                    <span class="n">errorbars</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">col</span><span class="p">[:</span><span class="o">-</span><span class="mi">9</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">errorbars</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="n">col</span><span class="p">:</span> <span class="n">col</span><span class="p">[:</span><span class="o">-</span><span class="mi">9</span><span class="p">]},</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">plot_dataframe</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;yerr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">errorbars</span>

        <span class="n">axes_handle</span> <span class="o">=</span> <span class="n">plot_dataframe</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">plot_dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">axes_handle</span><span class="o">.</span><span class="n">figure</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="c1"># Saving</span>
        <span class="k">if</span> <span class="n">figname</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span><span class="p">,</span> <span class="n">figname</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_id</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_id</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">axes_handle</span></div></div>


<div class="viewcode-block" id="CurrentCorrelationFunction"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.CurrentCorrelationFunction">[docs]</a><span class="k">class</span> <span class="nc">CurrentCorrelationFunction</span><span class="p">(</span><span class="n">Observable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Current Correlation Functions: :math:`L(k,\\omega)` and :math:`T(k,\\omega)`.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    k_list : list</span>
<span class="sd">        List of all possible :math:`k` vectors with their corresponding magnitudes and indexes.</span>

<span class="sd">    k_counts : numpy.ndarray</span>
<span class="sd">        Number of occurrences of each :math:`k` magnitude.</span>

<span class="sd">    ka_values : numpy.ndarray</span>
<span class="sd">        Magnitude of each allowed :math:`ka` vector.</span>

<span class="sd">    no_ka_values: int</span>
<span class="sd">        Length of ``ka_values`` array.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="CurrentCorrelationFunction.setup"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.CurrentCorrelationFunction.setup">[docs]</a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assign attributes from simulation&#39;s parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        phase : str</span>
<span class="sd">            Phase to analyze.</span>

<span class="sd">        params : sarkas.base.Parameters</span>
<span class="sd">            Simulation&#39;s parameters.</span>

<span class="sd">        species : list</span>
<span class="sd">            List of sarkas.base.Species.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span> <span class="k">if</span> <span class="n">phase</span> <span class="k">else</span> <span class="s1">&#39;production&#39;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setup_init</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">)</span>

        <span class="n">saving_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">postprocessing_dir</span><span class="p">,</span> <span class="s1">&#39;CurrentCorrelationFunction&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">saving_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">saving_dir</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">saving_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filename_csv_longitudinal</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span><span class="p">,</span>
                                                      <span class="s2">&quot;LongitudinalCurrentCorrelationFunction_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_id</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename_csv_transverse</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span><span class="p">,</span>
                                                    <span class="s2">&quot;TransverseCurrentCorrelationFunction_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_id</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CurrentCorrelationFunction.compute"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.CurrentCorrelationFunction.compute">[docs]</a>    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the velocity fluctuations correlation functions.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Parse vkt otherwise calculate them</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vkt_file</span> <span class="o">+</span> <span class="s1">&#39;_slice_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_slices</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.npz&#39;</span><span class="p">)</span>
            <span class="n">k_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k_list</span> <span class="o">=</span> <span class="n">k_data</span><span class="p">[</span><span class="s2">&quot;k_list&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k_counts</span> <span class="o">=</span> <span class="n">k_data</span><span class="p">[</span><span class="s2">&quot;k_counts&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ka_values</span> <span class="o">=</span> <span class="n">k_data</span><span class="p">[</span><span class="s2">&quot;ka_values&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">no_ka_values</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ka_values</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_counts</span><span class="p">,</span> <span class="n">k_unique</span> <span class="o">=</span> <span class="n">kspace_setup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_ka_harmonics</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_lengths</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ka_values</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k_unique</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_ws</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">no_ka_values</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ka_values</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_space_dir</span><span class="p">)):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_space_dir</span><span class="p">)</span>

            <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_file</span><span class="p">,</span>
                     <span class="n">k_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">k_list</span><span class="p">,</span>
                     <span class="n">k_counts</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">k_counts</span><span class="p">,</span>
                     <span class="n">ka_values</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ka_values</span><span class="p">)</span>
            <span class="n">start_slice</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">end_slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice_steps</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span>
            <span class="k">for</span> <span class="n">isl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_slices</span><span class="p">):</span>
                <span class="n">vkt</span><span class="p">,</span> <span class="n">vkt_i</span><span class="p">,</span> <span class="n">vkt_j</span><span class="p">,</span> <span class="n">vkt_k</span> <span class="o">=</span> <span class="n">calc_vkt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dump_dir</span><span class="p">,</span>
                                                    <span class="p">(</span><span class="n">start_slice</span><span class="p">,</span> <span class="n">end_slice</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice_steps</span><span class="p">),</span>
                                                    <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span><span class="p">,</span>
                                                    <span class="bp">self</span><span class="o">.</span><span class="n">species_num</span><span class="p">,</span>
                                                    <span class="bp">self</span><span class="o">.</span><span class="n">k_list</span><span class="p">,</span>
                                                    <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
                <span class="n">start_slice</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice_steps</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span>
                <span class="n">end_slice</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice_steps</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span>

                <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vkt_file</span> <span class="o">+</span> <span class="s1">&#39;_slice_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">isl</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.npz&#39;</span><span class="p">,</span>
                         <span class="n">longitudinal</span><span class="o">=</span><span class="n">vkt</span><span class="p">,</span>
                         <span class="n">transverse_i</span><span class="o">=</span><span class="n">vkt_i</span><span class="p">,</span>
                         <span class="n">transverse_j</span><span class="o">=</span><span class="n">vkt_j</span><span class="p">,</span>
                         <span class="n">transverse_k</span><span class="o">=</span><span class="n">vkt_k</span><span class="p">)</span>

        <span class="c1"># Initialize dataframes and add frequencies to it.</span>
        <span class="n">no_dumps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice_steps</span>
        <span class="n">frequencies</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="n">no_dumps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe_longitudinal</span><span class="p">[</span><span class="s2">&quot;Frequencies&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe_transverse</span><span class="p">[</span><span class="s2">&quot;Frequencies&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span>

        <span class="n">temp_dataframe_longitudinal</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">temp_dataframe_longitudinal</span><span class="p">[</span><span class="s2">&quot;Frequencies&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span>

        <span class="n">temp_dataframe_transverse</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">temp_dataframe_transverse</span><span class="p">[</span><span class="s2">&quot;Frequencies&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span>

        <span class="n">Lkw_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">no_obs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_counts</span><span class="p">),</span> <span class="n">no_dumps</span><span class="p">))</span>
        <span class="n">Tkw_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">no_obs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_counts</span><span class="p">),</span> <span class="n">no_dumps</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">isl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_slices</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vkt_file</span> <span class="o">+</span> <span class="s1">&#39;_slice_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">isl</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.npz&#39;</span><span class="p">)</span>
            <span class="n">vkt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;longitudinal&quot;</span><span class="p">]</span>
            <span class="n">vkt_i</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;transverse_i&quot;</span><span class="p">]</span>
            <span class="n">vkt_j</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;transverse_j&quot;</span><span class="p">]</span>
            <span class="n">vkt_k</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;transverse_k&quot;</span><span class="p">]</span>

            <span class="c1"># Calculate Lkw and Tkw</span>
            <span class="n">Lkw</span> <span class="o">=</span> <span class="n">calc_Skw</span><span class="p">(</span><span class="n">vkt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_counts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_num</span><span class="p">,</span> <span class="n">no_dumps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span><span class="p">)</span>
            <span class="n">Tkw_i</span> <span class="o">=</span> <span class="n">calc_Skw</span><span class="p">(</span><span class="n">vkt_i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_counts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_num</span><span class="p">,</span> <span class="n">no_dumps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span><span class="p">)</span>
            <span class="n">Tkw_j</span> <span class="o">=</span> <span class="n">calc_Skw</span><span class="p">(</span><span class="n">vkt_j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_counts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_num</span><span class="p">,</span> <span class="n">no_dumps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span><span class="p">)</span>
            <span class="n">Tkw_k</span> <span class="o">=</span> <span class="n">calc_Skw</span><span class="p">(</span><span class="n">vkt_k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_counts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_num</span><span class="p">,</span> <span class="n">no_dumps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span><span class="p">)</span>
            <span class="n">Tkw</span> <span class="o">=</span> <span class="p">(</span><span class="n">Tkw_i</span> <span class="o">+</span> <span class="n">Tkw_j</span> <span class="o">+</span> <span class="n">Tkw_k</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.0</span>

            <span class="n">Lkw_tot</span> <span class="o">+=</span> <span class="n">Lkw</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_slices</span>
            <span class="n">Tkw_tot</span> <span class="o">+=</span> <span class="n">Tkw</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_slices</span>

            <span class="n">sp_indx</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sp1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_names</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">sp2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_names</span><span class="p">[</span><span class="n">i</span><span class="p">:]):</span>
                    <span class="k">for</span> <span class="n">ik</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_counts</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="n">ik</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">column</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2"> CCF ka_min&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp1</span><span class="p">,</span> <span class="n">sp2</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">column</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2"> CCF </span><span class="si">{}</span><span class="s2"> ka_min&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp1</span><span class="p">,</span> <span class="n">sp2</span><span class="p">,</span> <span class="n">ik</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

                        <span class="n">temp_dataframe_longitudinal</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">Lkw</span><span class="p">[</span><span class="n">sp_indx</span><span class="p">,</span> <span class="n">ik</span><span class="p">,</span> <span class="p">:])</span>
                        <span class="n">temp_dataframe_transverse</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">Tkw</span><span class="p">[</span><span class="n">sp_indx</span><span class="p">,</span> <span class="n">ik</span><span class="p">,</span> <span class="p">:])</span>
                    <span class="n">sp_indx</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">temp_dataframe_longitudinal</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_csv_longitudinal</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_slice_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">isl</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">,</span>
                                               <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
            <span class="n">temp_dataframe_transverse</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_csv_transverse</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_slice_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">isl</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">,</span>
                                             <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

        <span class="c1"># Repeat the saving procedure for the total Lkw and Tkw</span>
        <span class="n">sp_indx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sp1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_names</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">sp2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_names</span><span class="p">[</span><span class="n">i</span><span class="p">:]):</span>
                <span class="k">for</span> <span class="n">ik</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_counts</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">ik</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">column</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2"> CCF ka_min&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp1</span><span class="p">,</span> <span class="n">sp2</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">column</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2"> CCF </span><span class="si">{}</span><span class="s2"> ka_min&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp1</span><span class="p">,</span> <span class="n">sp2</span><span class="p">,</span> <span class="n">ik</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">dataframe_longitudinal</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">Lkw</span><span class="p">[</span><span class="n">sp_indx</span><span class="p">,</span> <span class="n">ik</span><span class="p">,</span> <span class="p">:])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dataframe_transverse</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">Tkw</span><span class="p">[</span><span class="n">sp_indx</span><span class="p">,</span> <span class="n">ik</span><span class="p">,</span> <span class="p">:])</span>
                <span class="n">sp_indx</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe_longitudinal</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_csv_longitudinal</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe_transverse</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_csv_transverse</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="DynamicStructureFactor"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.DynamicStructureFactor">[docs]</a><span class="k">class</span> <span class="nc">DynamicStructureFactor</span><span class="p">(</span><span class="n">Observable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dynamic Structure factor.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    k_list : list</span>
<span class="sd">        List of all possible :math:`k` vectors with their corresponding magnitudes and indexes.</span>

<span class="sd">    k_counts : numpy.ndarray</span>
<span class="sd">        Number of occurrences of each :math:`k` magnitude.</span>

<span class="sd">    ka_values : numpy.ndarray</span>
<span class="sd">        Magnitude of each allowed :math:`ka` vector.</span>

<span class="sd">    no_ka_values: int</span>
<span class="sd">        Length of ``ka_values`` array.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DynamicStructureFactor.setup"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.DynamicStructureFactor.setup">[docs]</a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assign attributes from simulation&#39;s parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        phase : (optional), str</span>
<span class="sd">            Phase to analyze.</span>

<span class="sd">        params : sarkas.base.Parameters</span>
<span class="sd">            Simulation&#39;s parameters.</span>

<span class="sd">        species : list</span>
<span class="sd">            List of ``sarkas.base.Species``.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span> <span class="k">if</span> <span class="n">phase</span> <span class="k">else</span> <span class="s1">&#39;production&#39;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setup_init</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">)</span>

        <span class="c1"># Create the directory where to store the computed data</span>
        <span class="n">saving_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">postprocessing_dir</span><span class="p">,</span> <span class="s1">&#39;DynamicStructureFactor&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">saving_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">saving_dir</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">saving_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filename_csv</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span><span class="p">,</span> <span class="s2">&quot;DynamicStructureFactor_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_id</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DynamicStructureFactor.compute"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.DynamicStructureFactor.compute">[docs]</a>    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute :math:`S_{ij} (k,\\omega)` and the array of :math:`\\omega` values.</span>
<span class="sd">        ``self.Skw``. Shape = (``no_ws``, ``no_Sij``)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Parse nkt otherwise calculate it</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">k_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k_list</span> <span class="o">=</span> <span class="n">k_data</span><span class="p">[</span><span class="s2">&quot;k_list&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k_counts</span> <span class="o">=</span> <span class="n">k_data</span><span class="p">[</span><span class="s2">&quot;k_counts&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ka_values</span> <span class="o">=</span> <span class="n">k_data</span><span class="p">[</span><span class="s2">&quot;ka_values&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">no_ka_values</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ka_values</span><span class="p">)</span>
            <span class="n">nkt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nkt_file</span> <span class="o">+</span> <span class="s1">&#39;_slice_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_slices</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.npy&#39;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_counts</span><span class="p">,</span> <span class="n">k_unique</span> <span class="o">=</span> <span class="n">kspace_setup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_ka_harmonics</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_lengths</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ka_values</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k_unique</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_ws</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">no_ka_values</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ka_values</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_space_dir</span><span class="p">)):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_space_dir</span><span class="p">)</span>

            <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_file</span><span class="p">,</span>
                     <span class="n">k_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">k_list</span><span class="p">,</span>
                     <span class="n">k_counts</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">k_counts</span><span class="p">,</span>
                     <span class="n">ka_values</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ka_values</span><span class="p">)</span>

            <span class="n">start_slice</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">end_slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice_steps</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span>
            <span class="k">for</span> <span class="n">isl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_slices</span><span class="p">):</span>
                <span class="n">nkt</span> <span class="o">=</span> <span class="n">calc_nkt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dump_dir</span><span class="p">,</span>
                               <span class="p">(</span><span class="n">start_slice</span><span class="p">,</span> <span class="n">end_slice</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice_steps</span><span class="p">),</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">species_num</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">k_list</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
                <span class="n">start_slice</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice_steps</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span>
                <span class="n">end_slice</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice_steps</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span>
                <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nkt_file</span> <span class="o">+</span> <span class="s1">&#39;_slice_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">isl</span><span class="p">),</span> <span class="n">nkt</span><span class="p">)</span>

        <span class="n">frequencies</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice_steps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Frequencies&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span>

        <span class="n">temp_dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">temp_dataframe</span><span class="p">[</span><span class="s2">&quot;Frequencies&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span>

        <span class="n">Skw_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">no_obs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_counts</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice_steps</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">isl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_slices</span><span class="p">):</span>
            <span class="n">nkt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nkt_file</span> <span class="o">+</span> <span class="s1">&#39;_slice_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">isl</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.npy&#39;</span><span class="p">)</span>

            <span class="c1"># Calculate Skw</span>
            <span class="n">Skw</span> <span class="o">=</span> <span class="n">calc_Skw</span><span class="p">(</span><span class="n">nkt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_counts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_num</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice_steps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span><span class="p">)</span>

            <span class="n">Skw_tot</span> <span class="o">+=</span> <span class="n">Skw</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_slices</span>

            <span class="c1"># Save Skw</span>
            <span class="n">sp_indx</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sp1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_names</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">sp2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_names</span><span class="p">[</span><span class="n">i</span><span class="p">:]):</span>
                    <span class="k">for</span> <span class="n">ik</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_counts</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="n">ik</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">column</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2"> DSF ka_min&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp1</span><span class="p">,</span> <span class="n">sp2</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">column</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2"> DSF </span><span class="si">{}</span><span class="s2"> ka_min&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp1</span><span class="p">,</span> <span class="n">sp2</span><span class="p">,</span> <span class="n">ik</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="n">temp_dataframe</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">Skw</span><span class="p">[</span><span class="n">sp_indx</span><span class="p">,</span> <span class="n">ik</span><span class="p">,</span> <span class="p">:])</span>
                    <span class="n">sp_indx</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">temp_dataframe</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_csv</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_slice_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">isl</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

        <span class="c1"># Repeat the saving procedure for the total Skw</span>
        <span class="n">sp_indx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sp1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_names</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">sp2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_names</span><span class="p">[</span><span class="n">i</span><span class="p">:]):</span>
                <span class="k">for</span> <span class="n">ik</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_counts</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">ik</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">column</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2"> DSF ka_min&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp1</span><span class="p">,</span> <span class="n">sp2</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">column</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2"> DSF </span><span class="si">{}</span><span class="s2"> ka_min&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp1</span><span class="p">,</span> <span class="n">sp2</span><span class="p">,</span> <span class="n">ik</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">Skw_tot</span><span class="p">[</span><span class="n">sp_indx</span><span class="p">,</span> <span class="n">ik</span><span class="p">,</span> <span class="p">:])</span>
                <span class="n">sp_indx</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_csv</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ElectricCurrent"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.ElectricCurrent">[docs]</a><span class="k">class</span> <span class="nc">ElectricCurrent</span><span class="p">(</span><span class="n">Observable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Electric Current Auto-correlation function.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    dataframe : pandas.DataFrame</span>
<span class="sd">        Dataframe of the longitudinal velocity correlation functions.</span>

<span class="sd">    saving_dir : str</span>
<span class="sd">        Path to directory where computed data is stored.</span>

<span class="sd">    filename_csv : str</span>
<span class="sd">        Name of file for the longitudinal velocities fluctuation correlation function.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ElectricCurrent.setup"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.ElectricCurrent.setup">[docs]</a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the attributes from simulation&#39;s parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        phase : (optional), str</span>
<span class="sd">            Phase to analyze.</span>

<span class="sd">        params: sarkas.base.Parameters</span>
<span class="sd">            Simulation&#39;s parameters.</span>

<span class="sd">        species : list</span>
<span class="sd">            List of ``sarkas.base.Species``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span> <span class="k">if</span> <span class="n">phase</span> <span class="k">else</span> <span class="s1">&#39;production&#39;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setup_init</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">)</span>

        <span class="c1"># Create the directory where to store the computed data</span>
        <span class="n">saving_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">postprocessing_dir</span><span class="p">,</span> <span class="s1">&#39;ElectricCurrent&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">saving_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">saving_dir</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">saving_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filename_csv</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span><span class="p">,</span> <span class="s2">&quot;ElectricCurrent_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_id</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ElectricCurrent.compute"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.ElectricCurrent.compute">[docs]</a>    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the electric current and the corresponding auto-correlation functions.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Parse the particles from the dump files</span>
        <span class="n">vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">no_dumps</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_num_ptcls</span><span class="p">))</span>
        <span class="c1">#</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Parsing particles&#39; velocities.&quot;</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_dumps</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_dumps</span><span class="p">),</span> <span class="n">disable</span><span class="o">=</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)):</span>
            <span class="n">dump</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">it</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span><span class="p">)</span>
            <span class="n">time</span><span class="p">[</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">dump</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span>
            <span class="n">datap</span> <span class="o">=</span> <span class="n">load_from_restart</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dump_dir</span><span class="p">,</span> <span class="n">dump</span><span class="p">)</span>
            <span class="n">vel</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">datap</span><span class="p">[</span><span class="s2">&quot;vel&quot;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">vel</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">datap</span><span class="p">[</span><span class="s2">&quot;vel&quot;</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">vel</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">datap</span><span class="p">[</span><span class="s2">&quot;vel&quot;</span><span class="p">][:,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="c1">#</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculating Electric current quantities.&quot;</span><span class="p">)</span>
        <span class="n">species_current</span><span class="p">,</span> <span class="n">total_current</span> <span class="o">=</span> <span class="n">calc_elec_current</span><span class="p">(</span><span class="n">vel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_charges</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_num</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Total Current X&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_current</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Total Current Y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_current</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Total Current Z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_current</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>

        <span class="n">cur_acf_xx</span> <span class="o">=</span> <span class="n">autocorrelationfunction_1D</span><span class="p">(</span><span class="n">total_current</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">cur_acf_yy</span> <span class="o">=</span> <span class="n">autocorrelationfunction_1D</span><span class="p">(</span><span class="n">total_current</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">cur_acf_zz</span> <span class="o">=</span> <span class="n">autocorrelationfunction_1D</span><span class="p">(</span><span class="n">total_current</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:])</span>

        <span class="n">tot_cur_acf</span> <span class="o">=</span> <span class="n">autocorrelationfunction</span><span class="p">(</span><span class="n">total_current</span><span class="p">)</span>
        <span class="c1"># Normalize and save</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;X Current ACF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cur_acf_xx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Y Current ACF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cur_acf_yy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Z Current ACF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cur_acf_zz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Total Current ACF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tot_cur_acf</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_names</span><span class="p">):</span>
            <span class="n">tot_acf</span> <span class="o">=</span> <span class="n">autocorrelationfunction</span><span class="p">(</span><span class="n">species_current</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
            <span class="n">acf_xx</span> <span class="o">=</span> <span class="n">autocorrelationfunction_1D</span><span class="p">(</span><span class="n">species_current</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
            <span class="n">acf_yy</span> <span class="o">=</span> <span class="n">autocorrelationfunction_1D</span><span class="p">(</span><span class="n">species_current</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>
            <span class="n">acf_zz</span> <span class="o">=</span> <span class="n">autocorrelationfunction_1D</span><span class="p">(</span><span class="n">species_current</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> Total Current&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                <span class="n">species_current</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">species_current</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">species_current</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> X Current&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp</span><span class="p">)]</span> <span class="o">=</span> <span class="n">species_current</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> Y Current&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp</span><span class="p">)]</span> <span class="o">=</span> <span class="n">species_current</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> Z Current&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp</span><span class="p">)]</span> <span class="o">=</span> <span class="n">species_current</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> Total Current ACF&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp</span><span class="p">)]</span> <span class="o">=</span> <span class="n">tot_acf</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> X Current ACF&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp</span><span class="p">)]</span> <span class="o">=</span> <span class="n">acf_xx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> Y Current ACF&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp</span><span class="p">)]</span> <span class="o">=</span> <span class="n">acf_yy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> Z Current ACF&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp</span><span class="p">)]</span> <span class="o">=</span> <span class="n">acf_zz</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_csv</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HermiteCoefficients"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.HermiteCoefficients">[docs]</a><span class="k">class</span> <span class="nc">HermiteCoefficients</span><span class="p">(</span><span class="n">Observable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Hermite coefficients of the Hermite expansion.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    hermite_order: int</span>
<span class="sd">        Order of the Hermite expansion.</span>

<span class="sd">    no_bins: int</span>
<span class="sd">        Number of bins used to calculate the velocity distribution.</span>

<span class="sd">    plots_dir: str</span>
<span class="sd">        Directory in which to store Hermite coefficients plots.</span>

<span class="sd">    species_plots_dirs : list, str</span>
<span class="sd">        Directory for each species where to save Hermite coefficients plots.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HermiteCoefficients.setup"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.HermiteCoefficients.setup">[docs]</a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assign attributes from simulation&#39;s parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        phase : (optional), str</span>
<span class="sd">            Phase to analyze.</span>

<span class="sd">        params : sarkas.base.Parameters</span>
<span class="sd">            Simulation&#39;s parameters.</span>

<span class="sd">        species : list</span>
<span class="sd">            List of ``sarkas.base.Species``.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span> <span class="k">if</span> <span class="n">phase</span> <span class="k">else</span> <span class="s1">&#39;equilibration&#39;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setup_init</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">)</span>

        <span class="c1"># Create the directory where to store the computed data</span>
        <span class="n">saving_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">postprocessing_dir</span><span class="p">,</span> <span class="s1">&#39;HermiteExpansion&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">saving_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">saving_dir</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">saving_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename_csv</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span><span class="p">,</span> <span class="s2">&quot;HermiteCoefficients_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_id</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plots_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span><span class="p">,</span> <span class="s1">&#39;Hermite_Plots&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots_dir</span><span class="p">)</span>

        <span class="c1"># Check that the existence of important attributes</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;no_bins&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">no_bins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.05</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">total_num_ptcls</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;hermite_order&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hermite_order</span> <span class="o">=</span> <span class="mi">7</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">species_plots_dirs</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="HermiteCoefficients.compute"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.HermiteCoefficients.compute">[docs]</a>    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate Hermite coefficients and save the pandas dataframe.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vscale</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a_ws</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_plasma_frequency</span><span class="p">)</span>
        <span class="n">vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_num_ptcls</span><span class="p">))</span>

        <span class="n">xcoeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">num_species</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_dumps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hermite_order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">ycoeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">num_species</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_dumps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hermite_order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">zcoeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">num_species</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_dumps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hermite_order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_dumps</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computing Hermite Coefficients ...&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_dumps</span><span class="p">):</span>
            <span class="n">time</span><span class="p">[</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">it</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span>
            <span class="n">dump</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">it</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span><span class="p">)</span>
            <span class="n">datap</span> <span class="o">=</span> <span class="n">load_from_restart</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dump_dir</span><span class="p">,</span> <span class="n">dump</span><span class="p">)</span>
            <span class="n">vel</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">datap</span><span class="p">[</span><span class="s2">&quot;vel&quot;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">vel</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">datap</span><span class="p">[</span><span class="s2">&quot;vel&quot;</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">vel</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">datap</span><span class="p">[</span><span class="s2">&quot;vel&quot;</span><span class="p">][:,</span> <span class="mi">2</span><span class="p">]</span>

            <span class="n">sp_start</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">sp_end</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_num</span><span class="p">):</span>
                <span class="n">sp_end</span> <span class="o">+=</span> <span class="n">sp</span>
                <span class="n">x_hist</span><span class="p">,</span> <span class="n">xbins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">vel</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">sp_start</span><span class="p">:</span><span class="n">sp_end</span><span class="p">]</span> <span class="o">*</span> <span class="n">vscale</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">no_bins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">y_hist</span><span class="p">,</span> <span class="n">ybins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">vel</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">sp_start</span><span class="p">:</span><span class="n">sp_end</span><span class="p">]</span> <span class="o">*</span> <span class="n">vscale</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">no_bins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">z_hist</span><span class="p">,</span> <span class="n">zbins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">vel</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">sp_start</span><span class="p">:</span><span class="n">sp_end</span><span class="p">]</span> <span class="o">*</span> <span class="n">vscale</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">no_bins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="c1"># Center the bins</span>
                <span class="n">vx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">xbins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">xbins</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                <span class="n">vy</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">ybins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ybins</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                <span class="n">vz</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">zbins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">zbins</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

                <span class="n">xcoeff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">it</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">calculate_herm_coeff</span><span class="p">(</span><span class="n">vx</span><span class="p">,</span> <span class="n">x_hist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hermite_order</span><span class="p">)</span>
                <span class="n">ycoeff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">it</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">calculate_herm_coeff</span><span class="p">(</span><span class="n">vy</span><span class="p">,</span> <span class="n">y_hist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hermite_order</span><span class="p">)</span>
                <span class="n">zcoeff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">it</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">calculate_herm_coeff</span><span class="p">(</span><span class="n">vz</span><span class="p">,</span> <span class="n">z_hist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hermite_order</span><span class="p">)</span>

                <span class="n">sp_start</span> <span class="o">=</span> <span class="n">sp_end</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Time&quot;</span><span class="p">:</span> <span class="n">time</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_names</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">hi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hermite_order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> Hermite x Coeff a</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp</span><span class="p">,</span> <span class="n">hi</span><span class="p">)]</span> <span class="o">=</span> <span class="n">xcoeff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="n">hi</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> Hermite y Coeff a</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp</span><span class="p">,</span> <span class="n">hi</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ycoeff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="n">hi</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> Hermite z Coeff a</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp</span><span class="p">,</span> <span class="n">hi</span><span class="p">)]</span> <span class="o">=</span> <span class="n">zcoeff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="n">hi</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_csv</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HermiteCoefficients.plot"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.HermiteCoefficients.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the Hermite coefficients and save the figure</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_csv</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots_dir</span><span class="p">)</span>

        <span class="c1"># Create a plots directory for each species for the sake of neatness</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_species</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species_plots_dirs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_names</span><span class="p">):</span>
                <span class="n">new_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots_dir</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">species_plots_dirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_dir</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">new_dir</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots_dir</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species_plots_dirs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">plots_dir</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">sp</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_names</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Species: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">indx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hermite_order</span><span class="p">):</span>
                <span class="n">xcolumn</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> Hermite x Coeff a</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">indx</span><span class="p">)</span>
                <span class="n">ycolumn</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> Hermite y Coeff a</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">indx</span><span class="p">)</span>
                <span class="n">zcolumn</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> Hermite z Coeff a</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">indx</span><span class="p">)</span>
                <span class="n">xmul</span><span class="p">,</span> <span class="n">ymul</span><span class="p">,</span> <span class="n">xprefix</span><span class="p">,</span> <span class="n">yprefix</span><span class="p">,</span> <span class="n">xlbl</span><span class="p">,</span> <span class="n">ylbl</span> <span class="o">=</span> <span class="n">plot_labels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">,</span>
                                                                       <span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
                <span class="n">ia</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">indx</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">ia</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">xmul</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="n">xcolumn</span><span class="p">]</span> <span class="o">+</span> <span class="n">ia</span> <span class="o">*</span> <span class="p">(</span><span class="n">indx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
                            <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$a_{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">indx</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; , x}$&quot;</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">ia</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">xmul</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="n">ycolumn</span><span class="p">]</span> <span class="o">+</span> <span class="n">ia</span> <span class="o">*</span> <span class="p">(</span><span class="n">indx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
                            <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$a_{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">indx</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; , y}$&quot;</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">ia</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">xmul</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="n">zcolumn</span><span class="p">]</span> <span class="o">+</span> <span class="n">ia</span> <span class="o">*</span> <span class="p">(</span><span class="n">indx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
                            <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$a_{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">indx</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; , z}$&quot;</span><span class="p">)</span>

            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Even Coefficients&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Odd Coefficients&#39;</span><span class="p">)</span>

            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$t$&#39;</span> <span class="o">+</span> <span class="n">xlbl</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$t$&#39;</span> <span class="o">+</span> <span class="n">xlbl</span><span class="p">)</span>

            <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kB</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_temperatures</span><span class="p">[</span><span class="n">sp</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_masses</span><span class="p">[</span><span class="n">sp</span><span class="p">])</span>
            <span class="n">sigma</span> <span class="o">/=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a_ws</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_plasma_frequency</span><span class="p">)</span>  <span class="c1"># Rescale</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hermite_order</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">coeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">coeff</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Equilibrium a</span><span class="si">{}</span><span class="s2"> = </span><span class="si">{:1.2f}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">polynomial</span><span class="o">.</span><span class="n">hermite_e</span><span class="o">.</span><span class="n">hermeval</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)))</span>

            <span class="c1"># t_end = self.dataframe[&quot;Time&quot;].iloc[-1] * xmul/2</span>
            <span class="c1"># ax[0].text(t_end, 1.1, r&quot;$a_{0,\rm{eq}} = 1 $&quot;, transform=ax[0].transData)</span>
            <span class="c1"># # ax[0].axhline(1, ls=&#39;:&#39;, c=&#39;k&#39;, label=r&quot;$a_{0,\rm{eq}}$&quot;)</span>
            <span class="c1">#</span>
            <span class="c1"># ax[0].text(t_end, a2_eq * 0.97, r&quot;$a_{2,\rm{eq}} = &quot; + &quot;{:1.2f}&quot;.format(a2_eq) +&quot;$&quot;,</span>
            <span class="c1">#            transform=ax[0].transData)</span>
            <span class="c1">#</span>
            <span class="c1"># if self.hermite_order &gt; 3:</span>
            <span class="c1">#     ax[0].text(t_end, a4_eq * 1.1, r&quot;$a_{4,\rm{eq}} = &quot; + &quot;{:1.2f}&quot;.format(a4_eq) + &quot;$&quot;,</span>
            <span class="c1">#                transform=ax[0].transData)</span>
            <span class="c1">#</span>
            <span class="c1"># if self.hermite_order &gt; 5:</span>
            <span class="c1">#     ax[0].text(t_end, a6_eq * .98, r&quot;$a_{6,\rm{eq}} = &quot; + &quot;{:1.2f}&quot;.format(a6_eq) + &quot;$&quot;,</span>
            <span class="c1">#                transform=ax[0].transData)</span>

            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hermite_order</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">hermite_order</span> <span class="o">%</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hermite_order</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hermite_order</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">hermite_order</span> <span class="o">%</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">yt</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yt</span><span class="p">)))</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Hermite Coefficients of </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;  Phase: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
            <span class="n">plot_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_plots_dirs</span><span class="p">[</span><span class="n">sp</span><span class="p">],</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_HermCoeffPlot_&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                                     <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_id</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="RadialDistributionFunction"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.RadialDistributionFunction">[docs]</a><span class="k">class</span> <span class="nc">RadialDistributionFunction</span><span class="p">(</span><span class="n">Observable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Radial Distribution Function.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    no_bins : int</span>
<span class="sd">        Number of bins.</span>

<span class="sd">    dr_rdf : float</span>
<span class="sd">        Size of each bin.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="RadialDistributionFunction.setup"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.RadialDistributionFunction.setup">[docs]</a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assign attributes from simulation&#39;s parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        phase : (optional), str</span>
<span class="sd">            Phase to analyze.</span>

<span class="sd">        params : sarkas.base.Parameters</span>
<span class="sd">            Simulation&#39;s parameters.</span>

<span class="sd">        species : list</span>
<span class="sd">            List of ``sarkas.base.Species``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span> <span class="k">if</span> <span class="n">phase</span> <span class="k">else</span> <span class="s1">&#39;production&#39;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setup_init</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">)</span>

        <span class="n">saving_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">postprocessing_dir</span><span class="p">,</span> <span class="s1">&#39;RadialDistributionFunction&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">saving_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">saving_dir</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">saving_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filename_csv</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span><span class="p">,</span>
                                         <span class="s2">&quot;RadialDistributionFunction_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_id</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_radius</span></div>

<div class="viewcode-block" id="RadialDistributionFunction.compute"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.RadialDistributionFunction.compute">[docs]</a>    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rdf_hist</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rdf_hist : numpy.ndarray</span>
<span class="sd">            Histogram of the radial distribution function.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rdf_hist</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="c1"># Find the last dump by looking for the longest filename in</span>
            <span class="n">dumps_list</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dump_dir</span><span class="p">)</span>
            <span class="n">last</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">dumps_list</span><span class="p">:</span>
                <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">number</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">last</span><span class="p">:</span>
                    <span class="n">last</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">load_from_restart</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dump_dir</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">last</span><span class="p">))</span>
            <span class="n">rdf_hist</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;rdf_hist&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">no_bins</span> <span class="o">=</span> <span class="n">rdf_hist</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dr_rdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rc</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_bins</span>

        <span class="n">r_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_bins</span><span class="p">)</span>
        <span class="n">bin_vol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_bins</span><span class="p">)</span>
        <span class="n">pair_density</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">num_species</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_species</span><span class="p">))</span>
        <span class="n">gr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">no_bins</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_obs</span><span class="p">))</span>
        <span class="c1"># No. of pairs per volume</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sp1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_num</span><span class="p">):</span>
            <span class="n">pair_density</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sp1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sp1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_volume</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_species</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">sp2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_num</span><span class="p">[</span><span class="n">i</span><span class="p">:],</span> <span class="n">i</span><span class="p">):</span>
                    <span class="n">pair_density</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">sp1</span> <span class="o">*</span> <span class="n">sp2</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_volume</span>
        <span class="c1"># Calculate each bin&#39;s volume</span>
        <span class="n">sphere_shell_const</span> <span class="o">=</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">3.0</span>
        <span class="n">bin_vol</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sphere_shell_const</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_rdf</span> <span class="o">**</span> <span class="mi">3</span>
        <span class="k">for</span> <span class="n">ir</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_bins</span><span class="p">):</span>
            <span class="n">r1</span> <span class="o">=</span> <span class="n">ir</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_rdf</span>
            <span class="n">r2</span> <span class="o">=</span> <span class="p">(</span><span class="n">ir</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_rdf</span>
            <span class="n">bin_vol</span><span class="p">[</span><span class="n">ir</span><span class="p">]</span> <span class="o">=</span> <span class="n">sphere_shell_const</span> <span class="o">*</span> <span class="p">(</span><span class="n">r2</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">-</span> <span class="n">r1</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">r_values</span><span class="p">[</span><span class="n">ir</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ir</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_rdf</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">r_values</span>
        <span class="n">gr_ij</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sp1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_names</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">sp2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_names</span><span class="p">[</span><span class="n">i</span><span class="p">:],</span> <span class="n">i</span><span class="p">):</span>
                <span class="n">denom_const</span> <span class="o">=</span> <span class="p">(</span><span class="n">pair_density</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">production_steps</span><span class="p">)</span>
                <span class="n">gr</span><span class="p">[:,</span> <span class="n">gr_ij</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">rdf_hist</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">rdf_hist</span><span class="p">[:,</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">denom_const</span> <span class="o">/</span> <span class="n">bin_vol</span><span class="p">[:]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1"> RDF&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp1</span><span class="p">,</span> <span class="n">sp2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">gr</span><span class="p">[:,</span> <span class="n">gr_ij</span><span class="p">]</span>

                <span class="n">gr_ij</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_csv</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="StaticStructureFactor"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.StaticStructureFactor">[docs]</a><span class="k">class</span> <span class="nc">StaticStructureFactor</span><span class="p">(</span><span class="n">Observable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Static Structure Factors :math:`S_{ij}(k)`.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    k_list : list</span>
<span class="sd">        List of all possible :math:`k` vectors with their corresponding magnitudes and indexes.</span>

<span class="sd">    k_counts : numpy.ndarray</span>
<span class="sd">        Number of occurrences of each :math:`k` magnitude.</span>

<span class="sd">    ka_values : numpy.ndarray</span>
<span class="sd">        Magnitude of each allowed :math:`ka` vector.</span>

<span class="sd">    no_ka_values: int</span>
<span class="sd">        Length of ``ka_values`` array.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="StaticStructureFactor.setup"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.StaticStructureFactor.setup">[docs]</a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assign attributes from simulation&#39;s parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        phase : (optional), str</span>
<span class="sd">            Phase to analyze.</span>

<span class="sd">        params : sarkas.base.Parameters</span>
<span class="sd">            Simulation&#39;s parameters.</span>

<span class="sd">        species : list</span>
<span class="sd">            List of ``sarkas.base.Species``.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span> <span class="k">if</span> <span class="n">phase</span> <span class="k">else</span> <span class="s1">&#39;production&#39;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setup_init</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">)</span>

        <span class="n">saving_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">postprocessing_dir</span><span class="p">,</span> <span class="s1">&#39;StaticStructureFunction&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">saving_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">saving_dir</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">saving_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filename_csv</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span><span class="p">,</span> <span class="s2">&quot;StaticStructureFunction_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_id</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="StaticStructureFactor.compute"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.StaticStructureFactor.compute">[docs]</a>    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate all :math:`S_{ij}(k)`, save them into a Pandas dataframe, and write them to a csv.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Parse nkt otherwise calculate it</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">k_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k_list</span> <span class="o">=</span> <span class="n">k_data</span><span class="p">[</span><span class="s2">&quot;k_list&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k_counts</span> <span class="o">=</span> <span class="n">k_data</span><span class="p">[</span><span class="s2">&quot;k_counts&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ka_values</span> <span class="o">=</span> <span class="n">k_data</span><span class="p">[</span><span class="s2">&quot;ka_values&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">no_ka_values</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ka_values</span><span class="p">)</span>
            <span class="n">nkt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nkt_file</span> <span class="o">+</span> <span class="s1">&#39;_slice_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_slices</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.npy&#39;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_counts</span><span class="p">,</span> <span class="n">k_unique</span> <span class="o">=</span> <span class="n">kspace_setup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_ka_harmonics</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_lengths</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ka_values</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k_unique</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_ws</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">no_ka_values</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ka_values</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_space_dir</span><span class="p">)):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_space_dir</span><span class="p">)</span>

            <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_file</span><span class="p">,</span>
                     <span class="n">k_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">k_list</span><span class="p">,</span>
                     <span class="n">k_counts</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">k_counts</span><span class="p">,</span>
                     <span class="n">ka_values</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ka_values</span><span class="p">)</span>

            <span class="n">start_slice</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">end_slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice_steps</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span>
            <span class="k">for</span> <span class="n">isl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_slices</span><span class="p">):</span>
                <span class="n">nkt</span> <span class="o">=</span> <span class="n">calc_nkt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dump_dir</span><span class="p">,</span>
                               <span class="p">(</span><span class="n">start_slice</span><span class="p">,</span> <span class="n">end_slice</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice_steps</span><span class="p">),</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">species_num</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">k_list</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
                <span class="n">start_slice</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice_steps</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span>
                <span class="n">end_slice</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice_steps</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span>
                <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nkt_file</span> <span class="o">+</span> <span class="s1">&#39;_slice_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">isl</span><span class="p">),</span> <span class="n">nkt</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;ka values&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ka_values</span>

        <span class="n">no_dumps_calculated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice_steps</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_slices</span>
        <span class="n">Sk_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">no_obs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_counts</span><span class="p">),</span> <span class="n">no_dumps_calculated</span><span class="p">))</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculating S(k)&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">isl</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_slices</span><span class="p">)):</span>
            <span class="n">nkt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nkt_file</span> <span class="o">+</span> <span class="s1">&#39;_slice_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">isl</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.npy&#39;</span><span class="p">)</span>
            <span class="n">init</span> <span class="o">=</span> <span class="n">isl</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice_steps</span>
            <span class="n">fin</span> <span class="o">=</span> <span class="p">(</span><span class="n">isl</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice_steps</span>
            <span class="n">Sk_all</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">init</span><span class="p">:</span><span class="n">fin</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc_Sk</span><span class="p">(</span><span class="n">nkt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_counts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_num</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice_steps</span><span class="p">)</span>

        <span class="n">Sk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Sk_all</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">Sk_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">Sk_all</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">sp_indx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sp1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_names</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">sp2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_names</span><span class="p">[</span><span class="n">i</span><span class="p">:]):</span>
                <span class="n">column</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2"> SSF&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp1</span><span class="p">,</span> <span class="n">sp2</span><span class="p">)</span>
                <span class="n">err_column</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2"> SSF Errorbar&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp1</span><span class="p">,</span> <span class="n">sp2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">Sk</span><span class="p">[</span><span class="n">sp_indx</span><span class="p">,</span> <span class="p">:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="n">err_column</span><span class="p">]</span> <span class="o">=</span> <span class="n">Sk_err</span><span class="p">[</span><span class="n">sp_indx</span><span class="p">,</span> <span class="p">:]</span>

                <span class="n">sp_indx</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_csv</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Thermodynamics"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.Thermodynamics">[docs]</a><span class="k">class</span> <span class="nc">Thermodynamics</span><span class="p">(</span><span class="n">Observable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Thermodynamic functions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Thermodynamics.setup"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.Thermodynamics.setup">[docs]</a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assign attributes from simulation&#39;s parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        phase : (optional), str</span>
<span class="sd">            Phase to analyze.</span>

<span class="sd">        params : sarkas.base.Parameters</span>
<span class="sd">            Simulation&#39;s parameters.</span>

<span class="sd">        species : list</span>
<span class="sd">            List of ``sarkas.base.Species``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;phase&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span> <span class="k">if</span> <span class="n">phase</span> <span class="k">else</span> <span class="s1">&#39;production&#39;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setup_init</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">load_method</span> <span class="o">==</span> <span class="s2">&quot;restart&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restart_sim</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restart_sim</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Thermodynamics.compute_pressure_quantities"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.Thermodynamics.compute_pressure_quantities">[docs]</a>    <span class="k">def</span> <span class="nf">compute_pressure_quantities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate Pressure, Pressure Tensor, Pressure Tensor Auto Correlation Function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;production&#39;</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_num_ptcls</span><span class="p">))</span>
        <span class="n">vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_num_ptcls</span><span class="p">))</span>
        <span class="n">acc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_num_ptcls</span><span class="p">))</span>

        <span class="n">pressure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_dumps</span><span class="p">)</span>
        <span class="n">pressure_tensor_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_dumps</span><span class="p">))</span>

        <span class="c1"># Collect particles&#39; positions, velocities and accelerations</span>
        <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_dumps</span><span class="p">)):</span>
            <span class="n">dump</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">it</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span><span class="p">)</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">load_from_restart</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dump_dir</span><span class="p">,</span> <span class="n">dump</span><span class="p">)</span>
            <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;pos&quot;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;pos&quot;</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;pos&quot;</span><span class="p">][:,</span> <span class="mi">2</span><span class="p">]</span>

            <span class="n">vel</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;vel&quot;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">vel</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;vel&quot;</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">vel</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;vel&quot;</span><span class="p">][:,</span> <span class="mi">2</span><span class="p">]</span>

            <span class="n">acc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;acc&quot;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">acc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;acc&quot;</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">acc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;acc&quot;</span><span class="p">][:,</span> <span class="mi">2</span><span class="p">]</span>

            <span class="n">pressure</span><span class="p">[</span><span class="n">it</span><span class="p">],</span> <span class="n">pressure_tensor_temp</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc_pressure_tensor</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">vel</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_masses</span><span class="p">,</span>
                                                                                <span class="bp">self</span><span class="o">.</span><span class="n">species_num</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_volume</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Pressure&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pressure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Pressure ACF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">autocorrelationfunction_1D</span><span class="p">(</span><span class="n">pressure</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">dim_lbl</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">]</span>

        <span class="c1"># Calculate the acf of the pressure tensor</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dim_lbl</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">ax2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dim_lbl</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Pressure Tensor </span><span class="si">{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">pressure_tensor_temp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">pressure_tensor_acf_temp</span> <span class="o">=</span> <span class="n">autocorrelationfunction_1D</span><span class="p">(</span><span class="n">pressure_tensor_temp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Pressure Tensor ACF </span><span class="si">{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">pressure_tensor_acf_temp</span>

        <span class="c1"># Save the pressure acf to file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prod_energy_filename</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Thermodynamics.compute_pressure_from_rdf"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.Thermodynamics.compute_pressure_from_rdf">[docs]</a>    <span class="k">def</span> <span class="nf">compute_pressure_from_rdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">gr</span><span class="p">,</span> <span class="n">potential</span><span class="p">,</span> <span class="n">potential_matrix</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the Pressure using the radial distribution function</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        potential: str</span>
<span class="sd">            Potential used in the simulation.</span>

<span class="sd">        potential_matrix: numpy.ndarray</span>
<span class="sd">            Potential parameters.</span>

<span class="sd">        r : numpy.ndarray</span>
<span class="sd">            Particles&#39; distances.</span>

<span class="sd">        gr : numpy.ndarray</span>
<span class="sd">            Pair distribution function.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pressure : float</span>
<span class="sd">            Pressure divided by :math:`k_BT`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_ws</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">r</span>
        <span class="n">r3</span> <span class="o">=</span> <span class="n">r2</span> <span class="o">*</span> <span class="n">r</span>

        <span class="k">if</span> <span class="n">potential</span> <span class="o">==</span> <span class="s2">&quot;Coulomb&quot;</span><span class="p">:</span>
            <span class="n">dv_dr</span> <span class="o">=</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">r2</span>
            <span class="c1"># Check for finiteness of first element when r[0] = 0.0</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">dv_dr</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">dv_dr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">dv_dr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">potential</span> <span class="o">==</span> <span class="s2">&quot;Yukawa&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">potential</span> <span class="o">==</span> <span class="s2">&quot;QSP&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unknown potential&#39;</span><span class="p">)</span>

        <span class="c1"># No. of independent g(r)</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Temperature&quot;</span><span class="p">])</span>
        <span class="n">pressure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kB</span> <span class="o">*</span> <span class="n">T</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_dens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> \
                   <span class="o">*</span> <span class="n">potential_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">dv_dr</span> <span class="o">*</span> <span class="n">r3</span> <span class="o">*</span> <span class="n">gr</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">r</span><span class="p">)</span>
        <span class="n">pressure</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_dens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">pressure</span></div>

<div class="viewcode-block" id="Thermodynamics.plot"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.Thermodynamics.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;Total Energy&quot;</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot ``quantity`` vs time and save the figure with appropriate name.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        phase</span>
<span class="sd">        show : bool</span>
<span class="sd">            Flag for displaying figure.</span>

<span class="sd">        quantity : str</span>
<span class="sd">            Quantity to plot. Default = Total Energy.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">phase</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">quantity</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Pressure&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;Pressure&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculating Pressure quantities ...&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">compute_pressure_quantities</span><span class="p">()</span>

        <span class="n">xmul</span><span class="p">,</span> <span class="n">ymul</span><span class="p">,</span> <span class="n">xpref</span><span class="p">,</span> <span class="n">ypref</span><span class="p">,</span> <span class="n">xlbl</span><span class="p">,</span> <span class="n">ylbl</span> <span class="o">=</span> <span class="n">plot_labels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">],</span>
                                                           <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="n">quantity</span><span class="p">],</span>
                                                           <span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
        <span class="n">yq</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Total Energy&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$E_</span><span class="si">{tot}</span><span class="s2">(t)$&quot;</span><span class="p">,</span> <span class="s2">&quot;Kinetic Energy&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$K_</span><span class="si">{tot}</span><span class="s2">(t)$&quot;</span><span class="p">,</span> <span class="s2">&quot;Potential Energy&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$U_</span><span class="si">{tot}</span><span class="s2">(t)$&quot;</span><span class="p">,</span>
              <span class="s2">&quot;Temperature&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$T(t)$&quot;</span><span class="p">,</span>
              <span class="s2">&quot;Pressure Tensor ACF&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;$P_{\alpha\beta} = \langle P_{\alpha\beta}(0)P_{\alpha\beta}(t)\rangle$&#39;</span><span class="p">,</span>
              <span class="s2">&quot;Pressure Tensor&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$P_{\alpha\beta}(t)$&quot;</span><span class="p">,</span> <span class="s2">&quot;Gamma&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$\Gamma(t)$&quot;</span><span class="p">,</span> <span class="s2">&quot;Pressure&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$P(t)$&quot;</span><span class="p">}</span>
        <span class="n">dim_lbl</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;Pressure Tensor ACF&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dim1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dim_lbl</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">dim2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dim_lbl</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">xmul</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Pressure Tensor ACF </span><span class="si">{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dim1</span><span class="p">,</span> <span class="n">dim2</span><span class="p">)]</span> <span class="o">/</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Pressure Tensor ACF </span><span class="si">{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dim1</span><span class="p">,</span> <span class="n">dim2</span><span class="p">)][</span><span class="mi">0</span><span class="p">],</span>
                            <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$P_{&#39;</span> <span class="o">+</span> <span class="n">dim1</span> <span class="o">+</span> <span class="n">dim2</span> <span class="o">+</span> <span class="s1">&#39;} (t)$&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;Pressure Tensor&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dim1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dim_lbl</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">dim2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dim_lbl</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">xmul</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Pressure Tensor </span><span class="si">{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dim1</span><span class="p">,</span> <span class="n">dim2</span><span class="p">)]</span> <span class="o">*</span> <span class="n">ymul</span><span class="p">,</span>
                            <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$P_{&#39;</span> <span class="o">+</span> <span class="n">dim1</span> <span class="o">+</span> <span class="n">dim2</span> <span class="o">+</span> <span class="s1">&#39;} (t)$&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;Temperature&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_species</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_names</span><span class="p">:</span>
                <span class="n">qstr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> Temperature&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">xmul</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="n">qstr</span><span class="p">]</span> <span class="o">*</span> <span class="n">ymul</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">qstr</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">xmul</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Temperature&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ymul</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Total Temperature&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">xmul</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="n">quantity</span><span class="p">]</span> <span class="o">*</span> <span class="n">ymul</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">yq</span><span class="p">[</span><span class="n">quantity</span><span class="p">]</span> <span class="o">+</span> <span class="n">ylbl</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Time&#39;</span> <span class="o">+</span> <span class="n">xlbl</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fldr</span><span class="p">,</span> <span class="n">quantity</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_id</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="Thermodynamics.parse"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.Thermodynamics.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Grab the pandas dataframe from the saved csv file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">phase</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">==</span> <span class="s1">&#39;equilibration&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eq_energy_filename</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fldr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">equilibration_dir</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prod_energy_filename</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fldr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">production_dir</span></div>

<div class="viewcode-block" id="Thermodynamics.statistics"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.Thermodynamics.statistics">[docs]</a>    <span class="k">def</span> <span class="nf">statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;Total Energy&quot;</span><span class="p">,</span> <span class="n">max_no_divisions</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ToDo:</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        quantity</span>
<span class="sd">        max_no_divisions</span>
<span class="sd">        show</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>
        <span class="n">run_avg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="n">quantity</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">run_std</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="n">quantity</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

        <span class="n">observable</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="n">quantity</span><span class="p">])</span>
        <span class="c1"># Loop over the blocks</span>
        <span class="n">tau_blk</span><span class="p">,</span> <span class="n">sigma2_blk</span><span class="p">,</span> <span class="n">statistical_efficiency</span> <span class="o">=</span> <span class="n">calc_statistical_efficiency</span><span class="p">(</span><span class="n">observable</span><span class="p">,</span>
                                                                                  <span class="n">run_avg</span><span class="p">,</span> <span class="n">run_std</span><span class="p">,</span>
                                                                                  <span class="n">max_no_divisions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_dumps</span><span class="p">)</span>
        <span class="c1"># Plot the statistical efficiency</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">tau_blk</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="n">statistical_efficiency</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="s1">&#39;--o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">quantity</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$s(\tau_{\rm</span><span class="si">{blk}</span><span class="s1">})$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$1/\tau_{\rm</span><span class="si">{blk}</span><span class="s1">}$&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">postproc_dir</span><span class="p">,</span> <span class="n">quantity</span> <span class="o">+</span> <span class="s1">&#39;StatisticalEfficiency_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_id</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="Thermodynamics.temp_energy_plot"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.Thermodynamics.temp_energy_plot">[docs]</a>    <span class="k">def</span> <span class="nf">temp_energy_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot Temperature and Energy as a function of time with their cumulative sum and average.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        simulation : sarkas.processes.PostProcess</span>
<span class="sd">            Wrapper class.</span>

<span class="sd">        phase: str</span>
<span class="sd">            Phase to plot. &quot;equilibration&quot; or &quot;production&quot;.</span>

<span class="sd">        show: bool</span>
<span class="sd">            Flag for displaying the figure.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">phase</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">==</span> <span class="s1">&#39;equilibration&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">no_dumps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_no_dumps</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dump_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_dump_dir</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_dump_step</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fldr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">equilibration_dir</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">no_steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">equilibration_steps</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span>
                <span class="n">avg_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_dumps</span><span class="p">)])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">no_dumps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prod_no_dumps</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dump_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prod_dump_dir</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prod_dump_step</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fldr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">production_dir</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">no_steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">production_steps</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span>
                <span class="n">avg_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_dumps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="n">GridSpec</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="n">fsz</span> <span class="o">=</span> <span class="mi">16</span>

        <span class="n">nbins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.05</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_dumps</span><span class="p">)</span>

        <span class="n">Info_plot</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>

        <span class="n">T_hist_plot</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="n">T_delta_plot</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span>
        <span class="n">T_main_plot</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span>

        <span class="n">E_delta_plot</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span><span class="mi">7</span><span class="p">])</span>
        <span class="n">E_main_plot</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span><span class="mi">7</span><span class="p">])</span>
        <span class="n">E_hist_plot</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>

        <span class="c1"># Temperature plots</span>
        <span class="n">xmul</span><span class="p">,</span> <span class="n">ymul</span><span class="p">,</span> <span class="n">xprefix</span><span class="p">,</span> <span class="n">yprefix</span><span class="p">,</span> <span class="n">xlbl</span><span class="p">,</span> <span class="n">ylbl</span> <span class="o">=</span> <span class="n">plot_labels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">],</span>
                                                               <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Temperature&quot;</span><span class="p">],</span> <span class="s2">&quot;Time&quot;</span><span class="p">,</span>
                                                               <span class="s2">&quot;Temperature&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
        <span class="n">T_cumavg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Temperature&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span> <span class="o">/</span> <span class="n">avg_array</span>

        <span class="n">T_main_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xmul</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">],</span> <span class="n">ymul</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Temperature&quot;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="n">T_main_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xmul</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">],</span> <span class="n">ymul</span> <span class="o">*</span> <span class="n">T_cumavg</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Cum Avg&#39;</span><span class="p">)</span>
        <span class="n">T_main_plot</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">ymul</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_desired</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Desired T&#39;</span><span class="p">)</span>

        <span class="n">Delta_T</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Temperature&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_desired</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_desired</span>
        <span class="n">Delta_T_cum_avg</span> <span class="o">=</span> <span class="n">Delta_T</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span> <span class="o">/</span> <span class="n">avg_array</span>
        <span class="n">T_delta_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">xmul</span><span class="p">,</span> <span class="n">Delta_T</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">T_delta_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">xmul</span><span class="p">,</span> <span class="n">Delta_T_cum_avg</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

        <span class="n">T_delta_plot</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>
        <span class="n">T_delta_plot</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Deviation [%]&#39;</span><span class="p">)</span>
        <span class="n">T_delta_plot</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fsz</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">T_main_plot</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">)</span>
        <span class="n">T_main_plot</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
        <span class="n">T_main_plot</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Temperature&quot;</span> <span class="o">+</span> <span class="n">ylbl</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">)</span>
        <span class="n">T_main_plot</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span> <span class="o">+</span> <span class="n">xlbl</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">)</span>
        <span class="n">T_hist_plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;Temperature&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">nbins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span>
                         <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
        <span class="n">T_hist_plot</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>
        <span class="n">T_hist_plot</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>
        <span class="n">T_hist_plot</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">T_hist_plot</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Energy plots</span>
        <span class="n">xmul</span><span class="p">,</span> <span class="n">ymul</span><span class="p">,</span> <span class="n">xprefix</span><span class="p">,</span> <span class="n">yprefix</span><span class="p">,</span> <span class="n">xlbl</span><span class="p">,</span> <span class="n">ylbl</span> <span class="o">=</span> <span class="n">plot_labels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">],</span>
                                                               <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Total Energy&quot;</span><span class="p">],</span>
                                                               <span class="s2">&quot;Time&quot;</span><span class="p">,</span>
                                                               <span class="s2">&quot;Total Energy&quot;</span><span class="p">,</span>
                                                               <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>

        <span class="n">E_cumavg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Total Energy&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span> <span class="o">/</span> <span class="n">avg_array</span>

        <span class="n">E_main_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xmul</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">],</span> <span class="n">ymul</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Total Energy&quot;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="n">E_main_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xmul</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">],</span> <span class="n">ymul</span> <span class="o">*</span> <span class="n">E_cumavg</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Cum Avg&#39;</span><span class="p">)</span>
        <span class="n">E_main_plot</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">ymul</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Total Energy&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Avg&#39;</span><span class="p">)</span>

        <span class="n">Delta_E</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Total Energy&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Total Energy&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> \
                  <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Total Energy&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Delta_E_cum_avg</span> <span class="o">=</span> <span class="n">Delta_E</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span> <span class="o">/</span> <span class="n">avg_array</span>

        <span class="n">E_delta_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">xmul</span><span class="p">,</span> <span class="n">Delta_E</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">E_delta_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">xmul</span><span class="p">,</span> <span class="n">Delta_E_cum_avg</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
        <span class="n">E_delta_plot</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>
        <span class="n">E_delta_plot</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Deviation [%]&#39;</span><span class="p">)</span>
        <span class="n">E_delta_plot</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fsz</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">E_main_plot</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">)</span>
        <span class="n">E_main_plot</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
        <span class="n">E_main_plot</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Total Energy&quot;</span> <span class="o">+</span> <span class="n">ylbl</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">)</span>
        <span class="n">E_main_plot</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span> <span class="o">+</span> <span class="n">xlbl</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">)</span>

        <span class="n">E_hist_plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">xmul</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;Total Energy&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">nbins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
        <span class="n">E_hist_plot</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>
        <span class="n">E_hist_plot</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>

        <span class="n">xmul</span><span class="p">,</span> <span class="n">ymul</span><span class="p">,</span> <span class="n">xprefix</span><span class="p">,</span> <span class="n">yprefix</span><span class="p">,</span> <span class="n">xlbl</span><span class="p">,</span> <span class="n">ylbl</span> <span class="o">=</span> <span class="n">plot_labels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span>
                                                               <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Temperature&quot;</span><span class="p">],</span>
                                                               <span class="s2">&quot;Time&quot;</span><span class="p">,</span>
                                                               <span class="s2">&quot;Temperature&quot;</span><span class="p">,</span>
                                                               <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
        <span class="n">Info_plot</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
        <span class="n">Info_plot</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">Info_plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;Job ID: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">)</span>
        <span class="n">Info_plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">9.5</span><span class="p">,</span> <span class="s2">&quot;Phase: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">)</span>
        <span class="n">Info_plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="s2">&quot;No. of species = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_num</span><span class="p">)),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">)</span>
        <span class="n">y_coord</span> <span class="o">=</span> <span class="mf">8.5</span>
        <span class="k">for</span> <span class="n">isp</span><span class="p">,</span> <span class="n">sp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">simulation</span><span class="o">.</span><span class="n">species</span><span class="p">):</span>
            <span class="n">Info_plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">y_coord</span><span class="p">,</span> <span class="s2">&quot;Species </span><span class="si">{}</span><span class="s2"> : </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">isp</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sp</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">)</span>
            <span class="n">Info_plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">y_coord</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;  No. of particles = </span><span class="si">{}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">num</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">)</span>
            <span class="n">Info_plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">y_coord</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">,</span> <span class="s2">&quot;  Temperature = </span><span class="si">{:.4e}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ymul</span> <span class="o">*</span> <span class="n">sp</span><span class="o">.</span><span class="n">temperature</span><span class="p">,</span> <span class="n">ylbl</span><span class="p">),</span>
                           <span class="n">fontsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">)</span>
            <span class="n">y_coord</span> <span class="o">-=</span> <span class="mf">1.5</span>

        <span class="n">y_coord</span> <span class="o">-=</span> <span class="mf">0.25</span>
        <span class="n">Info_plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">y_coord</span><span class="p">,</span>
                       <span class="s2">&quot;Total $N$ = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">simulation</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">total_num_ptcls</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">)</span>
        <span class="n">Info_plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">y_coord</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span>
                       <span class="s2">&quot;Thermostat: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">simulation</span><span class="o">.</span><span class="n">thermostat</span><span class="o">.</span><span class="n">type</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">)</span>
        <span class="n">Info_plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">y_coord</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">,</span>
                       <span class="s2">&quot;Berendsen rate = </span><span class="si">{:1.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">simulation</span><span class="o">.</span><span class="n">thermostat</span><span class="o">.</span><span class="n">relaxation_rate</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">)</span>
        <span class="n">Info_plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">y_coord</span> <span class="o">-</span> <span class="mf">1.5</span><span class="p">,</span>
                       <span class="s2">&quot;Potential: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">simulation</span><span class="o">.</span><span class="n">potential</span><span class="o">.</span><span class="n">type</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">)</span>
        <span class="n">Info_plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">y_coord</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">,</span>
                       <span class="s2">&quot;Tot Force Error = </span><span class="si">{:1.4e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">simulation</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">force_error</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">)</span>

        <span class="n">Info_plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">y_coord</span> <span class="o">-</span> <span class="mf">2.5</span><span class="p">,</span>
                       <span class="s2">&quot;Timestep = </span><span class="si">{:1.4f}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xmul</span> <span class="o">*</span> <span class="n">simulation</span><span class="o">.</span><span class="n">integrator</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="n">xlbl</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">)</span>
        <span class="n">Info_plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">y_coord</span> <span class="o">-</span> <span class="mf">3.</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> step interval = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">)</span>
        <span class="n">Info_plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">y_coord</span> <span class="o">-</span> <span class="mf">3.5</span><span class="p">,</span>
                       <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> completed steps = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_dumps</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)),</span>
                       <span class="n">fontsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">)</span>
        <span class="n">Info_plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">y_coord</span> <span class="o">-</span> <span class="mf">4.</span><span class="p">,</span> <span class="s2">&quot;Tot </span><span class="si">{}</span><span class="s2"> steps = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_steps</span><span class="p">),</span>
                       <span class="n">fontsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">)</span>
        <span class="n">Info_plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">y_coord</span> <span class="o">-</span> <span class="mf">4.5</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{:1.2f}</span><span class="s2"> % </span><span class="si">{}</span><span class="s2"> Completed&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="mi">100</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_dumps</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_steps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">)</span>

        <span class="n">Info_plot</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fldr</span><span class="p">,</span> <span class="s1">&#39;EnsembleCheckPlot_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_id</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="VelocityAutoCorrelationFunction"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.VelocityAutoCorrelationFunction">[docs]</a><span class="k">class</span> <span class="nc">VelocityAutoCorrelationFunction</span><span class="p">(</span><span class="n">Observable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Velocity Auto-correlation function.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="VelocityAutoCorrelationFunction.setup"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.VelocityAutoCorrelationFunction.setup">[docs]</a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assign attributes from simulation&#39;s parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        phase : (optional), str</span>
<span class="sd">            Phase to analyze.</span>

<span class="sd">        params : sarkas.base.Parameters</span>
<span class="sd">            Simulation&#39;s parameters.</span>

<span class="sd">        species : list</span>
<span class="sd">            List of ``sarkas.base.Species``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span> <span class="k">if</span> <span class="n">phase</span> <span class="k">else</span> <span class="s1">&#39;production&#39;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setup_init</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">)</span>

        <span class="c1"># Create the directory where to store the computed data</span>
        <span class="n">saving_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">postprocessing_dir</span><span class="p">,</span> <span class="s1">&#39;VelocityAutoCorrelationFunction&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">saving_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">saving_dir</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">saving_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filename_csv</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span><span class="p">,</span> <span class="s2">&quot;VelocityACF_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_id</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="VelocityAutoCorrelationFunction.compute"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.VelocityAutoCorrelationFunction.compute">[docs]</a>    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_averaging</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">it_skip</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the velocity auto-correlation functions.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Parse the particles from the dump files</span>
        <span class="n">vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_num_ptcls</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_dumps</span><span class="p">))</span>
        <span class="c1">#</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Parsing particles&#39; velocities.&quot;</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_dumps</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_dumps</span><span class="p">),</span> <span class="n">disable</span><span class="o">=</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)):</span>
            <span class="n">dump</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">it</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span><span class="p">)</span>
            <span class="n">time</span><span class="p">[</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">dump</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span>
            <span class="n">datap</span> <span class="o">=</span> <span class="n">load_from_restart</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dump_dir</span><span class="p">,</span> <span class="n">dump</span><span class="p">)</span>
            <span class="n">vel</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">datap</span><span class="p">[</span><span class="s2">&quot;vel&quot;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">vel</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">datap</span><span class="p">[</span><span class="s2">&quot;vel&quot;</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">vel</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">datap</span><span class="p">[</span><span class="s2">&quot;vel&quot;</span><span class="p">][:,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span>
        <span class="k">if</span> <span class="n">time_averaging</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculating vacf with time averaging on...&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculating vacf with time averaging off...&quot;</span><span class="p">)</span>

        <span class="n">vacf</span> <span class="o">=</span> <span class="n">calc_vacf</span><span class="p">(</span><span class="n">vel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_num</span><span class="p">,</span> <span class="n">time_averaging</span><span class="p">,</span> <span class="n">it_skip</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sp1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_names</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> X Velocity ACF&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">vacf</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> Y Velocity ACF&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">vacf</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> Z Velocity ACF&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">vacf</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> Total Velocity ACF&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">vacf</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">:]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_csv</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="FluxAutoCorrelationFunction"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.FluxAutoCorrelationFunction">[docs]</a><span class="k">class</span> <span class="nc">FluxAutoCorrelationFunction</span><span class="p">(</span><span class="n">Observable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Diffusion Flux Auto-correlation function.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="FluxAutoCorrelationFunction.setup"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.FluxAutoCorrelationFunction.setup">[docs]</a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assign attributes from simulation&#39;s parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        phase : (optional), str</span>
<span class="sd">            Phase to analyze.</span>

<span class="sd">        params : sarkas.base.Parameters</span>
<span class="sd">            Simulation&#39;s parameters.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span> <span class="k">if</span> <span class="n">phase</span> <span class="k">else</span> <span class="s1">&#39;production&#39;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setup_init</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;species_mass_densities&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species_mass_densities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_num_dens</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_masses</span>

        <span class="c1"># Create the directory where to store the computed data</span>
        <span class="n">saving_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">postprocessing_dir</span><span class="p">,</span> <span class="s1">&#39;DiffusionFluxAutoCorrelationFunction&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">saving_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">saving_dir</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">saving_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filename_csv</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span><span class="p">,</span> <span class="s2">&quot;DiffusionFluxACF_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_id</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FluxAutoCorrelationFunction.compute"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.FluxAutoCorrelationFunction.compute">[docs]</a>    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_averaging</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">it_skip</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the velocity auto-correlation functions.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Parse the particles from the dump files</span>
        <span class="n">vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_num_ptcls</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_dumps</span><span class="p">))</span>
        <span class="c1">#</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Parsing particles&#39; velocities.&quot;</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_dumps</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_dumps</span><span class="p">),</span> <span class="n">disable</span><span class="o">=</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)):</span>
            <span class="n">dump</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">it</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span><span class="p">)</span>
            <span class="n">time</span><span class="p">[</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">dump</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span>
            <span class="n">datap</span> <span class="o">=</span> <span class="n">load_from_restart</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dump_dir</span><span class="p">,</span> <span class="n">dump</span><span class="p">)</span>
            <span class="n">vel</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">datap</span><span class="p">[</span><span class="s2">&quot;vel&quot;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">vel</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">datap</span><span class="p">[</span><span class="s2">&quot;vel&quot;</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">vel</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">datap</span><span class="p">[</span><span class="s2">&quot;vel&quot;</span><span class="p">][:,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span>
        <span class="k">if</span> <span class="n">time_averaging</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculating diffusion flux acf with time averaging on ...&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculating diffusion flux acf with time averaging off ...&quot;</span><span class="p">)</span>

        <span class="n">df_acf</span> <span class="o">=</span> <span class="n">calc_diff_flux_acf</span><span class="p">(</span><span class="n">vel</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">species_num</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">species_num_dens</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">species_masses</span><span class="p">,</span>
                                    <span class="n">time_averaging</span><span class="p">,</span>
                                    <span class="n">it_skip</span><span class="p">)</span>

        <span class="n">v_ij</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sp1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_names</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">sp2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_names</span><span class="p">[</span><span class="n">i</span><span class="p">:],</span> <span class="n">i</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2"> X Diffusion Flux ACF&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp1</span><span class="p">,</span> <span class="n">sp2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">df_acf</span><span class="p">[</span><span class="n">v_ij</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2"> Y Diffusion Flux ACF&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp1</span><span class="p">,</span> <span class="n">sp2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">df_acf</span><span class="p">[</span><span class="n">v_ij</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2"> Z Diffusion Flux ACF&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp1</span><span class="p">,</span> <span class="n">sp2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">df_acf</span><span class="p">[</span><span class="n">v_ij</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2"> Total Diffusion Flux ACF&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp1</span><span class="p">,</span> <span class="n">sp2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">df_acf</span><span class="p">[</span><span class="n">v_ij</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">v_ij</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_csv</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="VelocityMoments"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.VelocityMoments">[docs]</a><span class="k">class</span> <span class="nc">VelocityMoments</span><span class="p">(</span><span class="n">Observable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Moments of the velocity distributions defined as</span>

<span class="sd">    .. math::</span>
<span class="sd">        \\langle v^{\\alpha} \\rangle = \\int_{-\\infty}^{\\infty} d v \, f(v) v^{2 \\alpha}.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    no_bins: int</span>
<span class="sd">        Number of bins used to calculate the velocity distribution.</span>

<span class="sd">    plots_dir: str</span>
<span class="sd">        Directory in which to store Hermite coefficients plots.</span>

<span class="sd">    species_plots_dirs : list, str</span>
<span class="sd">        Directory for each species where to save Hermite coefficients plots.</span>

<span class="sd">    max_no_moment: int</span>
<span class="sd">        Maximum number of moments = :math:`\alpha`. Default = 3.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="VelocityMoments.setup"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.VelocityMoments.setup">[docs]</a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assign attributes from simulation&#39;s parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        phase : str</span>
<span class="sd">            Phase to compute.</span>

<span class="sd">        params : sarkas.base.Parameters</span>
<span class="sd">            Simulation&#39;s parameters.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span> <span class="k">if</span> <span class="n">phase</span> <span class="k">else</span> <span class="s1">&#39;production&#39;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setup_init</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">)</span>

        <span class="c1"># Create the directory where to store the computed data</span>
        <span class="n">saving_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">postprocessing_dir</span><span class="p">,</span> <span class="s1">&#39;VelocityMoments&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">saving_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">saving_dir</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">saving_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plots_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span><span class="p">,</span> <span class="s1">&#39;Plots&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots_dir</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filename_csv</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saving_dir</span><span class="p">,</span> <span class="s2">&quot;VelocityMoments_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_id</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;no_bins&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">no_bins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.05</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">total_num_ptcls</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;max_no_moment&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_no_moment</span> <span class="o">=</span> <span class="mi">3</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">species_plots_dirs</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="VelocityMoments.compute"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.VelocityMoments.compute">[docs]</a>    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the moments of the velocity distributions and save them to a pandas dataframes and csv.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vscale</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a_ws</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_plasma_frequency</span><span class="p">)</span>
        <span class="n">vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">no_dumps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_num_ptcls</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_dumps</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_dumps</span><span class="p">):</span>
            <span class="n">dump</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">it</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump_step</span><span class="p">)</span>
            <span class="n">datap</span> <span class="o">=</span> <span class="n">load_from_restart</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dump_dir</span><span class="p">,</span> <span class="n">dump</span><span class="p">)</span>
            <span class="n">vel</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">datap</span><span class="p">[</span><span class="s2">&quot;vel&quot;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">vscale</span>
            <span class="n">vel</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">datap</span><span class="p">[</span><span class="s2">&quot;vel&quot;</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">vscale</span>
            <span class="n">vel</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">datap</span><span class="p">[</span><span class="s2">&quot;vel&quot;</span><span class="p">][:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">vscale</span>
            <span class="n">time</span><span class="p">[</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">datap</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Time&quot;</span><span class="p">:</span> <span class="n">time</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculating velocity moments ...&quot;</span><span class="p">)</span>
        <span class="n">moments</span> <span class="o">=</span> <span class="n">calc_moments</span><span class="p">(</span><span class="n">vel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_bins</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_num</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculating ratios ...&quot;</span><span class="p">)</span>
        <span class="n">ratios</span> <span class="o">=</span> <span class="n">calc_moment_ratios</span><span class="p">(</span><span class="n">moments</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_num</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_dumps</span><span class="p">)</span>
        <span class="c1"># Save the dataframe</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_names</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> vx 2nd moment&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp</span><span class="p">)]</span> <span class="o">=</span> <span class="n">moments</span><span class="p">[:,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">i</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> vx 4th moment&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp</span><span class="p">)]</span> <span class="o">=</span> <span class="n">moments</span><span class="p">[:,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> vx 6th moment&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp</span><span class="p">)]</span> <span class="o">=</span> <span class="n">moments</span><span class="p">[:,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> vy 2nd moment&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp</span><span class="p">)]</span> <span class="o">=</span> <span class="n">moments</span><span class="p">[:,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> vy 4th moment&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp</span><span class="p">)]</span> <span class="o">=</span> <span class="n">moments</span><span class="p">[:,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> vy 6th moment&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp</span><span class="p">)]</span> <span class="o">=</span> <span class="n">moments</span><span class="p">[:,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> vz 2nd moment&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp</span><span class="p">)]</span> <span class="o">=</span> <span class="n">moments</span><span class="p">[:,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="mi">6</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> vz 4th moment&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp</span><span class="p">)]</span> <span class="o">=</span> <span class="n">moments</span><span class="p">[:,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="mi">7</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> vz 6th moment&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp</span><span class="p">)]</span> <span class="o">=</span> <span class="n">moments</span><span class="p">[:,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="mi">8</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> 4-2 moment ratio&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> 6-2 moment ratio&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_csv</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="VelocityMoments.plot_ratios"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.VelocityMoments.plot_ratios">[docs]</a>    <span class="k">def</span> <span class="nf">plot_ratios</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the moment ratios and save the figure.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        show : bool</span>
<span class="sd">            Flag for displaying the figure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots_dir</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_species</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species_plots_dirs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_names</span><span class="p">):</span>
                <span class="n">new_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots_dir</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">species_plots_dirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_dir</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">new_dir</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots_dir</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species_plots_dirs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">plots_dir</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_names</span><span class="p">):</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">xmul</span><span class="p">,</span> <span class="n">ymul</span><span class="p">,</span> <span class="n">xprefix</span><span class="p">,</span> <span class="n">yprefix</span><span class="p">,</span> <span class="n">xlbl</span><span class="p">,</span> <span class="n">ylbl</span> <span class="o">=</span> <span class="n">plot_labels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">],</span>
                                                                   <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">]),</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">xmul</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> 4-2 moment ratio&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp</span><span class="p">)],</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;4/2 ratio&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">xmul</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> 6-2 moment ratio&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp</span><span class="p">)],</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;6/2 ratio&quot;</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Equilibrium&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
            <span class="c1">#</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">==</span> <span class="s1">&#39;equilibration&#39;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$t$&#39;</span> <span class="o">+</span> <span class="n">xlbl</span><span class="p">)</span>
            <span class="c1">#</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Moments ratios of </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;  Phase: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_plots_dirs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s2">&quot;MomentRatios_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_id</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># this is useful because it will have too many figures open.</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="autocorrelationfunction"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.autocorrelationfunction">[docs]</a><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">autocorrelationfunction</span><span class="p">(</span><span class="n">At</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the autocorrelation function of the array input.</span>

<span class="sd">    .. math::</span>
<span class="sd">        A(\\tau) =  \sum_j^D \sum_i^T A_j(t_i)A_j(t_i + \\tau)</span>

<span class="sd">    where :math:`D` is the number of dimensions and :math:`T` is the total length</span>
<span class="sd">    of the simulation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    At : numpy.ndarray</span>
<span class="sd">        Observable to autocorrelate. Shape=(``no_dim``, ``no_steps``).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ACF : numpy.ndarray</span>
<span class="sd">        Autocorrelation function of ``At``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">no_steps</span> <span class="o">=</span> <span class="n">At</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">no_dim</span> <span class="o">=</span> <span class="n">At</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">ACF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">no_steps</span><span class="p">)</span>
    <span class="n">Norm_counter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">no_steps</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">no_steps</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">no_dim</span><span class="p">):</span>
            <span class="n">ACF</span><span class="p">[:</span> <span class="n">no_steps</span> <span class="o">-</span> <span class="n">it</span><span class="p">]</span> <span class="o">+=</span> <span class="n">At</span><span class="p">[</span><span class="n">dim</span><span class="p">,</span> <span class="n">it</span><span class="p">]</span> <span class="o">*</span> <span class="n">At</span><span class="p">[</span><span class="n">dim</span><span class="p">,</span> <span class="n">it</span><span class="p">:</span><span class="n">no_steps</span><span class="p">]</span>
        <span class="n">Norm_counter</span><span class="p">[:</span> <span class="n">no_steps</span> <span class="o">-</span> <span class="n">it</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>

    <span class="k">return</span> <span class="n">ACF</span> <span class="o">/</span> <span class="n">Norm_counter</span></div>


<div class="viewcode-block" id="autocorrelationfunction_1D"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.autocorrelationfunction_1D">[docs]</a><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">autocorrelationfunction_1D</span><span class="p">(</span><span class="n">At</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the autocorrelation function of the input.</span>

<span class="sd">    .. math::</span>
<span class="sd">        A(\\tau) =  \sum_i^T A(t_i)A(t_i + \\tau)</span>

<span class="sd">    where :math:`T` is the total length of the simulation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    At : numpy.ndarray</span>
<span class="sd">        Array to autocorrelate. Shape=(``no_steps``).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ACF : numpy.ndarray</span>
<span class="sd">        Autocorrelation function of ``At``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">no_steps</span> <span class="o">=</span> <span class="n">At</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ACF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">no_steps</span><span class="p">)</span>
    <span class="n">Norm_counter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">no_steps</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">no_steps</span><span class="p">):</span>
        <span class="n">ACF</span><span class="p">[:</span> <span class="n">no_steps</span> <span class="o">-</span> <span class="n">it</span><span class="p">]</span> <span class="o">+=</span> <span class="n">At</span><span class="p">[</span><span class="n">it</span><span class="p">]</span> <span class="o">*</span> <span class="n">At</span><span class="p">[</span><span class="n">it</span><span class="p">:</span><span class="n">no_steps</span><span class="p">]</span>
        <span class="n">Norm_counter</span><span class="p">[:</span> <span class="n">no_steps</span> <span class="o">-</span> <span class="n">it</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>

    <span class="k">return</span> <span class="n">ACF</span> <span class="o">/</span> <span class="n">Norm_counter</span></div>


<div class="viewcode-block" id="calc_Sk"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.calc_Sk">[docs]</a><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">calc_Sk</span><span class="p">(</span><span class="n">nkt</span><span class="p">,</span> <span class="n">ka_list</span><span class="p">,</span> <span class="n">ka_counts</span><span class="p">,</span> <span class="n">species_np</span><span class="p">,</span> <span class="n">no_dumps</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate :math:`S_{ij}(k)` at each saved timestep.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nkt : numpy.ndarray, complex</span>
<span class="sd">        Density fluctuations of all species. Shape = ( ``no_species``, ``no_dumps``, ``no_ka_values``)</span>

<span class="sd">    ka_list :</span>
<span class="sd">        List of :math:`k` indices in each direction with corresponding magnitude and index of ``ka_counts``.</span>
<span class="sd">        Shape=(``no_ka_values``, 5)</span>

<span class="sd">    ka_counts : numpy.ndarray</span>
<span class="sd">        Number of times each :math:`k` magnitude appears.</span>

<span class="sd">    species_np : numpy.ndarray</span>
<span class="sd">        Array with number of particles of each species.</span>

<span class="sd">    no_dumps : int</span>
<span class="sd">        Number of dumps.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    Sk_all : numpy.ndarray</span>
<span class="sd">        Array containing :math:`S_{ij}(k)`. Shape=(``no_Sk``, ``no_ka_values``, ``no_dumps``)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">no_sk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">species_np</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">species_np</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">Sk_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">no_sk</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ka_counts</span><span class="p">),</span> <span class="n">no_dumps</span><span class="p">))</span>

    <span class="n">pair_indx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">si</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">species_np</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">jp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">species_np</span><span class="p">)):</span>
            <span class="n">sj</span> <span class="o">=</span> <span class="n">species_np</span><span class="p">[</span><span class="n">jp</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">no_dumps</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">ik</span><span class="p">,</span> <span class="n">ka</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ka_list</span><span class="p">):</span>
                    <span class="n">indx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ka</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">nk_i</span> <span class="o">=</span> <span class="n">nkt</span><span class="p">[</span><span class="n">ip</span><span class="p">,</span> <span class="n">it</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span>
                    <span class="n">nk_j</span> <span class="o">=</span> <span class="n">nkt</span><span class="p">[</span><span class="n">jp</span><span class="p">,</span> <span class="n">it</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span>
                    <span class="n">Sk_all</span><span class="p">[</span><span class="n">pair_indx</span><span class="p">,</span> <span class="n">indx</span><span class="p">,</span> <span class="n">it</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">nk_i</span><span class="p">)</span> <span class="o">*</span> <span class="n">nk_j</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">ka_counts</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">si</span> <span class="o">*</span> <span class="n">sj</span><span class="p">))</span>
            <span class="n">pair_indx</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">Sk_all</span></div>


<div class="viewcode-block" id="calc_Skw"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.calc_Skw">[docs]</a><span class="k">def</span> <span class="nf">calc_Skw</span><span class="p">(</span><span class="n">nkt</span><span class="p">,</span> <span class="n">ka_list</span><span class="p">,</span> <span class="n">ka_counts</span><span class="p">,</span> <span class="n">species_np</span><span class="p">,</span> <span class="n">no_dumps</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">dump_step</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the Fourier transform of the correlation function of ``nkt``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nkt :  complex, numpy.ndarray</span>
<span class="sd">        Particles&#39; density or velocity fluctuations.</span>
<span class="sd">        Shape = ( ``no_species``, ``no_dumps``, ``no_k_list``)</span>

<span class="sd">    ka_list : list</span>
<span class="sd">        List of :math:`k` indices in each direction with corresponding magnitude and index of ``ka_counts``.</span>
<span class="sd">        Shape=(``no_ka_values``, 5)</span>

<span class="sd">    ka_counts : numpy.ndarray</span>
<span class="sd">        Number of times each :math:`k` magnitude appears.</span>

<span class="sd">    species_np : numpy.ndarray</span>
<span class="sd">        Array with one element giving number of particles.</span>

<span class="sd">    no_dumps : int</span>
<span class="sd">        Number of dumps.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Skw : numpy.ndarray</span>
<span class="sd">        DSF/CCF of each species and pair of species.</span>
<span class="sd">        Shape = (``no_skw``, ``no_ka_values``, ``no_dumps``)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">norm</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">no_dumps</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dump_step</span><span class="p">)</span>
    <span class="n">no_skw</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">species_np</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">species_np</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">Skw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">no_skw</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ka_counts</span><span class="p">),</span> <span class="n">no_dumps</span><span class="p">))</span>

    <span class="n">pair_indx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">si</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">species_np</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">jp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">species_np</span><span class="p">)):</span>
            <span class="n">sj</span> <span class="o">=</span> <span class="n">species_np</span><span class="p">[</span><span class="n">jp</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">ik</span><span class="p">,</span> <span class="n">ka</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ka_list</span><span class="p">):</span>
                <span class="n">indx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ka</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">nkw_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">nkt</span><span class="p">[</span><span class="n">ip</span><span class="p">,</span> <span class="p">:,</span> <span class="n">ik</span><span class="p">])</span> <span class="o">*</span> <span class="n">norm</span>
                <span class="n">nkw_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">nkt</span><span class="p">[</span><span class="n">jp</span><span class="p">,</span> <span class="p">:,</span> <span class="n">ik</span><span class="p">])</span> <span class="o">*</span> <span class="n">norm</span>
                <span class="n">Skw</span><span class="p">[</span><span class="n">pair_indx</span><span class="p">,</span> <span class="n">indx</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">nkw_i</span><span class="p">)</span> <span class="o">*</span> <span class="n">nkw_j</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">ka_counts</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">si</span> <span class="o">*</span> <span class="n">sj</span><span class="p">))</span>
            <span class="n">pair_indx</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">Skw</span></div>


<div class="viewcode-block" id="calc_elec_current"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.calc_elec_current">[docs]</a><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">calc_elec_current</span><span class="p">(</span><span class="n">vel</span><span class="p">,</span> <span class="n">sp_charge</span><span class="p">,</span> <span class="n">sp_num</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the total electric current and electric current of each species.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    vel: numpy.ndarray</span>
<span class="sd">        Particles&#39; velocities.</span>

<span class="sd">    sp_charge: numpy.ndarray</span>
<span class="sd">        Charge of each species.</span>

<span class="sd">    sp_num: numpy.ndarray</span>
<span class="sd">        Number of particles of each species.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Js : numpy.ndarray</span>
<span class="sd">        Electric current of each species. Shape = (``no_species``, ``no_dim``, ``no_dumps``)</span>

<span class="sd">    Jtot : numpy.ndarray</span>
<span class="sd">        Total electric current. Shape = (``no_dim``, ``no_dumps``)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num_species</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sp_num</span><span class="p">)</span>
    <span class="n">no_dumps</span> <span class="o">=</span> <span class="n">vel</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">Js</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_species</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">no_dumps</span><span class="p">))</span>
    <span class="n">Jtot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="n">no_dumps</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">no_dumps</span><span class="p">):</span>
        <span class="n">sp_start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_species</span><span class="p">):</span>
            <span class="n">sp_end</span> <span class="o">=</span> <span class="n">sp_start</span> <span class="o">+</span> <span class="n">sp_num</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
            <span class="c1"># Calculate the current of each species</span>
            <span class="n">Js</span><span class="p">[</span><span class="n">s</span><span class="p">,</span> <span class="p">:,</span> <span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">sp_charge</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vel</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="p">:,</span> <span class="n">sp_start</span><span class="p">:</span><span class="n">sp_end</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">Jtot</span><span class="p">[:,</span> <span class="n">it</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Js</span><span class="p">[</span><span class="n">s</span><span class="p">,</span> <span class="p">:,</span> <span class="n">it</span><span class="p">]</span>

            <span class="n">sp_start</span> <span class="o">=</span> <span class="n">sp_end</span>

    <span class="k">return</span> <span class="n">Js</span><span class="p">,</span> <span class="n">Jtot</span></div>


<div class="viewcode-block" id="calc_moment_ratios"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.calc_moment_ratios">[docs]</a><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">calc_moment_ratios</span><span class="p">(</span><span class="n">moments</span><span class="p">,</span> <span class="n">species_np</span><span class="p">,</span> <span class="n">no_dumps</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Take the ratio of the velocity moments.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    moments: numpy.ndarray</span>
<span class="sd">        Velocity moments of each species per direction at each time step.</span>

<span class="sd">    no_dumps: int</span>
<span class="sd">        Number of saved timesteps.</span>

<span class="sd">    species_np: numpy.ndarray</span>
<span class="sd">        Number of particles of each species.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ratios: numpy.ndarray</span>
<span class="sd">        Ratios of high order velocity moments with respoect the 2nd moment.</span>
<span class="sd">        Shape=(``no_species``,2, ``no_dumps``)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">no_ratios</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">ratios</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">species_np</span><span class="p">),</span> <span class="n">no_ratios</span><span class="p">,</span> <span class="n">no_dumps</span><span class="p">))</span>

    <span class="n">sp_start</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">sp</span><span class="p">,</span> <span class="n">nsp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">species_np</span><span class="p">):</span>
        <span class="n">sp_end</span> <span class="o">=</span> <span class="n">sp_start</span> <span class="o">+</span> <span class="n">nsp</span>

        <span class="n">vx2_mom</span> <span class="o">=</span> <span class="n">moments</span><span class="p">[:,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">sp</span><span class="p">)]</span>
        <span class="n">vx4_mom</span> <span class="o">=</span> <span class="n">moments</span><span class="p">[:,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">sp</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">vx6_mom</span> <span class="o">=</span> <span class="n">moments</span><span class="p">[:,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">sp</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>

        <span class="n">vy2_mom</span> <span class="o">=</span> <span class="n">moments</span><span class="p">[:,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">sp</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span>
        <span class="n">vy4_mom</span> <span class="o">=</span> <span class="n">moments</span><span class="p">[:,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">sp</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span>
        <span class="n">vy6_mom</span> <span class="o">=</span> <span class="n">moments</span><span class="p">[:,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">sp</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">]</span>

        <span class="n">vz2_mom</span> <span class="o">=</span> <span class="n">moments</span><span class="p">[:,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">sp</span><span class="p">)</span> <span class="o">+</span> <span class="mi">6</span><span class="p">]</span>
        <span class="n">vz4_mom</span> <span class="o">=</span> <span class="n">moments</span><span class="p">[:,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">sp</span><span class="p">)</span> <span class="o">+</span> <span class="mi">7</span><span class="p">]</span>
        <span class="n">vz6_mom</span> <span class="o">=</span> <span class="n">moments</span><span class="p">[:,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">sp</span><span class="p">)</span> <span class="o">+</span> <span class="mi">8</span><span class="p">]</span>

        <span class="n">ratios</span><span class="p">[</span><span class="n">sp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vx4_mom</span> <span class="o">/</span> <span class="n">vx2_mom</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">vy4_mom</span> <span class="o">/</span> <span class="n">vy2_mom</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">vz4_mom</span> <span class="o">/</span> <span class="n">vz2_mom</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mf">27.0</span>
        <span class="n">ratios</span><span class="p">[</span><span class="n">sp</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vx6_mom</span> <span class="o">/</span> <span class="n">vx2_mom</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">vy6_mom</span> <span class="o">/</span> <span class="n">vy2_mom</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">vz6_mom</span> <span class="o">/</span> <span class="n">vz2_mom</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mf">15.0</span> <span class="o">**</span> <span class="mi">3</span>

        <span class="n">sp_start</span> <span class="o">=</span> <span class="n">sp_end</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ratios</span></div>


<div class="viewcode-block" id="calc_moments"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.calc_moments">[docs]</a><span class="k">def</span> <span class="nf">calc_moments</span><span class="p">(</span><span class="n">vel</span><span class="p">,</span> <span class="n">nbins</span><span class="p">,</span> <span class="n">species_np</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the even moments of the velocity distributions.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    vel: numpy.ndarray</span>
<span class="sd">        Particles&#39; velocity at each time step.</span>

<span class="sd">    nbins: int</span>
<span class="sd">        Number of bins to be used for the distribution.</span>

<span class="sd">    species_np: numpy.ndarray</span>
<span class="sd">        Number of particles of each species.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    moments: numpy.ndarray</span>
<span class="sd">        2nd, 4th, 8th moment of the velocity distributions.</span>
<span class="sd">        Shape=( ``no_dumps``, ``9 * len(species_np)``)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">no_dumps</span> <span class="o">=</span> <span class="n">vel</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">moments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">no_dumps</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">species_np</span><span class="p">))))</span>

    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">no_dumps</span><span class="p">):</span>
        <span class="n">sp_start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">sp</span><span class="p">,</span> <span class="n">nsp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">species_np</span><span class="p">):</span>
            <span class="n">sp_end</span> <span class="o">=</span> <span class="n">sp_start</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">nsp</span><span class="p">)</span>

            <span class="n">xdist</span><span class="p">,</span> <span class="n">xbins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">vel</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="n">sp_start</span><span class="p">:</span><span class="n">sp_end</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">nbins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">ydist</span><span class="p">,</span> <span class="n">ybins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">vel</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="n">sp_start</span><span class="p">:</span><span class="n">sp_end</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">nbins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">zdist</span><span class="p">,</span> <span class="n">zbins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">vel</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="n">sp_start</span><span class="p">:</span><span class="n">sp_end</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">nbins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">vx</span> <span class="o">=</span> <span class="p">(</span><span class="n">xbins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">xbins</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mf">2.</span>
            <span class="n">vy</span> <span class="o">=</span> <span class="p">(</span><span class="n">ybins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ybins</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mf">2.</span>
            <span class="n">vz</span> <span class="o">=</span> <span class="p">(</span><span class="n">zbins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">zbins</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mf">2.</span>

            <span class="n">moments</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">sp</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vx</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">xdist</span><span class="p">)</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">vx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">vx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">moments</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">sp</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vx</span> <span class="o">**</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">xdist</span><span class="p">)</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">vx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">vx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">moments</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">sp</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vx</span> <span class="o">**</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">xdist</span><span class="p">)</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">vx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">vx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">moments</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">sp</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vy</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ydist</span><span class="p">)</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">vy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">vy</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">moments</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">sp</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vy</span> <span class="o">**</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">ydist</span><span class="p">)</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">vy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">vy</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">moments</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">sp</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vy</span> <span class="o">**</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">ydist</span><span class="p">)</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">vy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">vy</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">moments</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">sp</span><span class="p">)</span> <span class="o">+</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vz</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">zdist</span><span class="p">)</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">vz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">vz</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">moments</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">sp</span><span class="p">)</span> <span class="o">+</span> <span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vz</span> <span class="o">**</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">zdist</span><span class="p">)</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">vz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">vz</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">moments</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">sp</span><span class="p">)</span> <span class="o">+</span> <span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vz</span> <span class="o">**</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">zdist</span><span class="p">)</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">vz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">vz</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">sp_start</span> <span class="o">=</span> <span class="n">sp_end</span>

    <span class="k">return</span> <span class="n">moments</span></div>


<div class="viewcode-block" id="calc_nk"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.calc_nk">[docs]</a><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">calc_nk</span><span class="p">(</span><span class="n">pos_data</span><span class="p">,</span> <span class="n">k_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the instantaneous microscopic density :math:`n(k)` defined as</span>

<span class="sd">    .. math::</span>
<span class="sd">        n_{A} ( k ) = \sum_i^{N_A} \exp [ -i \mathbf k \cdot \mathbf r_{i} ]</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pos_data : numpy.ndarray</span>
<span class="sd">        Particles&#39; position scaled by the box lengths.</span>
<span class="sd">        Shape = ( ``no_dumps``, ``no_dim``, ``tot_no_ptcls``)</span>

<span class="sd">    k_list : list</span>
<span class="sd">        List of :math:`k` indices in each direction with corresponding magnitude and index of ``ka_counts``.</span>
<span class="sd">        Shape=(``no_ka_values``, 5)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    nk : numpy.ndarray</span>
<span class="sd">        Array containing :math:`n(k)`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">nk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k_list</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ik</span><span class="p">,</span> <span class="n">k_vec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">k_list</span><span class="p">):</span>
        <span class="n">kr_i</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">k_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">pos_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">k_vec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">pos_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">k_vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">pos_data</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="n">nk</span><span class="p">[</span><span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">kr_i</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">nk</span></div>


<div class="viewcode-block" id="calc_nkt"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.calc_nkt">[docs]</a><span class="k">def</span> <span class="nf">calc_nkt</span><span class="p">(</span><span class="n">fldr</span><span class="p">,</span> <span class="n">slices</span><span class="p">,</span> <span class="n">dump_step</span><span class="p">,</span> <span class="n">species_np</span><span class="p">,</span> <span class="n">k_list</span><span class="p">,</span> <span class="n">verbose</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate density fluctuations :math:`n(k,t)` of all species.</span>

<span class="sd">    .. math::</span>
<span class="sd">        n_{A} ( k, t ) = \sum_i^{N_A} \exp [ -i \mathbf k \cdot \mathbf r_{i}(t) ]</span>

<span class="sd">    where :math:`N_A` is the number of particles of species :math:`A`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fldr : str</span>
<span class="sd">        Name of folder containing particles data.</span>

<span class="sd">    slices : tuple, int</span>
<span class="sd">        Initial, final step number of the slice, total number of slice steps.</span>

<span class="sd">    dump_step : int</span>
<span class="sd">        Timestep interval saving.</span>

<span class="sd">    species_np : numpy.ndarray</span>
<span class="sd">        Number of particles of each species.</span>

<span class="sd">    k_list : list</span>
<span class="sd">        List of :math: `k` vectors.</span>

<span class="sd">    Return</span>
<span class="sd">    ------</span>
<span class="sd">    nkt : numpy.ndarray, complex</span>
<span class="sd">        Density fluctuations.  Shape = ( ``no_species``, ``no_dumps``, ``no_ka_values``)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Read particles&#39; position for all times</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculating n(k,t).&quot;</span><span class="p">)</span>
    <span class="n">nkt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">species_np</span><span class="p">),</span> <span class="n">slices</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">k_list</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">it</span><span class="p">,</span> <span class="n">dump</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">slices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">slices</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dump_step</span><span class="p">),</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">verbose</span><span class="p">)):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">load_from_restart</span><span class="p">(</span><span class="n">fldr</span><span class="p">,</span> <span class="n">dump</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;pos&quot;</span><span class="p">]</span>
        <span class="n">sp_start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">sp_end</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">species_np</span><span class="p">):</span>
            <span class="n">sp_end</span> <span class="o">+=</span> <span class="n">sp</span>
            <span class="n">nkt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">it</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">calc_nk</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">sp_start</span><span class="p">:</span><span class="n">sp_end</span><span class="p">,</span> <span class="p">:],</span> <span class="n">k_list</span><span class="p">)</span>
            <span class="n">sp_start</span> <span class="o">+=</span> <span class="n">sp</span>

    <span class="k">return</span> <span class="n">nkt</span></div>


<div class="viewcode-block" id="calc_pressure_tensor"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.calc_pressure_tensor">[docs]</a><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">calc_pressure_tensor</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">vel</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">species_mass</span><span class="p">,</span> <span class="n">species_np</span><span class="p">,</span> <span class="n">box_volume</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the pressure tensor.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pos : numpy.ndarray</span>
<span class="sd">        Particles&#39; positions.</span>

<span class="sd">    vel : numpy.ndarray</span>
<span class="sd">        Particles&#39; velocities.</span>

<span class="sd">    acc : numpy.ndarray</span>
<span class="sd">        Particles&#39; accelerations.</span>

<span class="sd">    species_mass : numpy.ndarray</span>
<span class="sd">        Mass of each species.</span>

<span class="sd">    species_np : numpy.ndarray</span>
<span class="sd">        Number of particles of each species.</span>

<span class="sd">    box_volume : float</span>
<span class="sd">        Volume of simulation&#39;s box.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pressure : float</span>
<span class="sd">        Scalar Pressure i.e. trace of the pressure tensor</span>

<span class="sd">    pressure_tensor : numpy.ndarray</span>
<span class="sd">        Pressure tensor. Shape(``no_dim``,``no_dim``)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sp_start</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Rescale vel and acc of each particle by their individual mass</span>
    <span class="k">for</span> <span class="n">sp</span><span class="p">,</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">species_np</span><span class="p">):</span>
        <span class="n">sp_end</span> <span class="o">=</span> <span class="n">sp_start</span> <span class="o">+</span> <span class="n">num</span>
        <span class="n">vel</span><span class="p">[:,</span> <span class="n">sp_start</span><span class="p">:</span> <span class="n">sp_end</span><span class="p">]</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">species_mass</span><span class="p">[</span><span class="n">sp</span><span class="p">])</span>
        <span class="n">acc</span><span class="p">[:,</span> <span class="n">sp_start</span><span class="p">:</span> <span class="n">sp_end</span><span class="p">]</span> <span class="o">*=</span> <span class="n">species_mass</span><span class="p">[</span><span class="n">sp</span><span class="p">]</span>  <span class="c1"># force</span>
        <span class="n">sp_start</span> <span class="o">=</span> <span class="n">sp_end</span>

    <span class="n">pressure_tensor</span> <span class="o">=</span> <span class="p">(</span><span class="n">vel</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">vel</span><span class="p">)</span> <span class="o">+</span> <span class="n">pos</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">acc</span><span class="p">))</span> <span class="o">/</span> <span class="n">box_volume</span>
    <span class="n">pressure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">pressure_tensor</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.0</span>

    <span class="k">return</span> <span class="n">pressure</span><span class="p">,</span> <span class="n">pressure_tensor</span></div>


<div class="viewcode-block" id="calc_statistical_efficiency"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.calc_statistical_efficiency">[docs]</a><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">calc_statistical_efficiency</span><span class="p">(</span><span class="n">observable</span><span class="p">,</span> <span class="n">run_avg</span><span class="p">,</span> <span class="n">run_std</span><span class="p">,</span> <span class="n">max_no_divisions</span><span class="p">,</span> <span class="n">no_dumps</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Todo:</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    observable</span>
<span class="sd">    run_avg</span>
<span class="sd">    run_std</span>
<span class="sd">    max_no_divisions</span>
<span class="sd">    no_dumps</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tau_blk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">max_no_divisions</span><span class="p">)</span>
    <span class="n">sigma2_blk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">max_no_divisions</span><span class="p">)</span>
    <span class="n">statistical_efficiency</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">max_no_divisions</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_no_divisions</span><span class="p">):</span>
        <span class="n">tau_blk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">no_dumps</span> <span class="o">/</span> <span class="n">i</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="n">t_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">j</span> <span class="o">*</span> <span class="n">tau_blk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">t_end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">tau_blk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">blk_avg</span> <span class="o">=</span> <span class="n">observable</span><span class="p">[</span><span class="n">t_start</span><span class="p">:</span><span class="n">t_end</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">sigma2_blk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">blk_avg</span> <span class="o">-</span> <span class="n">run_avg</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">sigma2_blk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">statistical_efficiency</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tau_blk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">sigma2_blk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">run_std</span> <span class="o">**</span> <span class="mi">2</span>

    <span class="k">return</span> <span class="n">tau_blk</span><span class="p">,</span> <span class="n">sigma2_blk</span><span class="p">,</span> <span class="n">statistical_efficiency</span></div>


<div class="viewcode-block" id="calc_diff_flux_acf"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.calc_diff_flux_acf">[docs]</a><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">calc_diff_flux_acf</span><span class="p">(</span><span class="n">vel</span><span class="p">,</span> <span class="n">sp_num</span><span class="p">,</span> <span class="n">sp_dens</span><span class="p">,</span> <span class="n">sp_mass</span><span class="p">,</span> <span class="n">time_averaging</span><span class="p">,</span> <span class="n">it_skip</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the diffusion flux autocorrelation function of each species and in each direction.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    time_averaging: bool</span>
<span class="sd">        Flag for time averaging.</span>

<span class="sd">    it_skip: int</span>
<span class="sd">        Timestep interval for time averaging.</span>

<span class="sd">    vel : numpy.ndarray</span>
<span class="sd">        Particles&#39; velocities.</span>

<span class="sd">    sp_num: numpy.ndarray</span>
<span class="sd">        Number of particles of each species.</span>

<span class="sd">    sp_dens: numpy.ndarray</span>
<span class="sd">        Number densities of each species.</span>

<span class="sd">    sp_mass: numpy.ndarray</span>
<span class="sd">        Particle&#39;s mass of each species.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    jc_acf: numpy.ndarray</span>
<span class="sd">        Diffusion flux autocorrelation function. Shape Ns*(Ns +1)/2 x Ndim + 1 x Nt, where Ns = number of species,</span>
<span class="sd">        Ndim = Number of cartesian dimensions, Nt = Number of dumps.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">no_dim</span> <span class="o">=</span> <span class="n">vel</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">no_dumps</span> <span class="o">=</span> <span class="n">vel</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">no_species</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sp_num</span><span class="p">)</span>
    <span class="n">no_vacf</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">no_species</span> <span class="o">*</span> <span class="p">(</span><span class="n">no_species</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>

    <span class="n">mass_densities</span> <span class="o">=</span> <span class="n">sp_dens</span> <span class="o">*</span> <span class="n">sp_mass</span>
    <span class="n">tot_mass_dens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mass_densities</span><span class="p">)</span>
    <span class="c1"># Center of mass velocity field of each species</span>
    <span class="n">com_vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">no_species</span><span class="p">,</span> <span class="n">no_dim</span><span class="p">,</span> <span class="n">no_dumps</span><span class="p">))</span>
    <span class="c1"># Total center of mass velocity field, see eq.(18) in</span>
    <span class="c1"># Haxhimali T. et al., Diffusivity of Mixtures in Warm Dense Matter Regime.In: Graziani F., et al. (eds)</span>
    <span class="c1"># Frontiers and Challenges in Warm Dense Matter. Lecture Notes in Computational Science and Engineering, vol 96.</span>
    <span class="c1"># Springer (2014)</span>
    <span class="n">tot_com_vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">no_dim</span><span class="p">,</span> <span class="n">no_dumps</span><span class="p">))</span>

    <span class="n">sp_start</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">sp_end</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ns</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sp_num</span><span class="p">):</span>
        <span class="n">sp_end</span> <span class="o">+=</span> <span class="n">ns</span>
        <span class="n">com_vel</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vel</span><span class="p">[:,</span> <span class="n">sp_start</span><span class="p">:</span> <span class="n">sp_end</span><span class="p">,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">tot_com_vel</span> <span class="o">+=</span> <span class="n">mass_densities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">com_vel</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">/</span> <span class="n">tot_mass_dens</span>
        <span class="n">sp_start</span> <span class="o">=</span> <span class="n">sp_end</span>

    <span class="n">jc_acf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">no_vacf</span><span class="p">,</span> <span class="n">no_dim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">no_dumps</span><span class="p">))</span>
    <span class="c1"># the flux is given by eq.(19) of the above reference</span>
    <span class="n">indx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">time_averaging</span><span class="p">:</span>
        <span class="n">indx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">no_species</span><span class="p">):</span>
            <span class="n">sp1_flux</span> <span class="o">=</span> <span class="n">mass_densities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">com_vel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">tot_com_vel</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">no_species</span><span class="p">):</span>
                <span class="n">sp2_flux</span> <span class="o">=</span> <span class="n">mass_densities</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">com_vel</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">tot_com_vel</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">no_dim</span><span class="p">):</span>
                    <span class="n">norm_counter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">no_dumps</span><span class="p">)</span>
                    <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">no_dumps</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">no_dumps</span><span class="p">,</span> <span class="n">it_skip</span><span class="p">):</span>
                        <span class="n">temp</span><span class="p">[:</span><span class="n">no_dumps</span> <span class="o">-</span> <span class="n">it</span><span class="p">]</span> <span class="o">+=</span> <span class="n">correlationfunction_1D</span><span class="p">(</span><span class="n">sp1_flux</span><span class="p">[</span><span class="n">d</span><span class="p">,</span> <span class="n">it</span><span class="p">:],</span> <span class="n">sp2_flux</span><span class="p">[</span><span class="n">d</span><span class="p">,</span> <span class="n">it</span><span class="p">:])</span>
                        <span class="n">norm_counter</span><span class="p">[:(</span><span class="n">no_dumps</span> <span class="o">-</span> <span class="n">it</span><span class="p">)]</span> <span class="o">+=</span> <span class="mf">1.0</span>
                    <span class="n">jc_acf</span><span class="p">[</span><span class="n">indx</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">/</span> <span class="n">norm_counter</span>

                <span class="n">norm_counter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">no_dumps</span><span class="p">)</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">no_dumps</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">no_dumps</span><span class="p">,</span> <span class="n">it_skip</span><span class="p">):</span>
                    <span class="n">temp</span><span class="p">[:</span> <span class="n">no_dumps</span> <span class="o">-</span> <span class="n">it</span><span class="p">]</span> <span class="o">+=</span> <span class="n">correlationfunction</span><span class="p">(</span><span class="n">sp1_flux</span><span class="p">[:,</span> <span class="n">it</span><span class="p">:],</span> <span class="n">sp2_flux</span><span class="p">[:,</span> <span class="n">it</span><span class="p">:])</span>
                    <span class="n">norm_counter</span><span class="p">[:(</span><span class="n">no_dumps</span> <span class="o">-</span> <span class="n">it</span><span class="p">)]</span> <span class="o">+=</span> <span class="mf">1.0</span>
                <span class="n">jc_acf</span><span class="p">[</span><span class="n">indx</span><span class="p">,</span> <span class="n">no_dim</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">/</span> <span class="n">norm_counter</span>
                <span class="n">indx</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rho1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mass_densities</span><span class="p">):</span>
            <span class="n">sp1_flux</span> <span class="o">=</span> <span class="n">rho1</span> <span class="o">*</span> <span class="p">(</span><span class="n">com_vel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">tot_com_vel</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">rho2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mass_densities</span><span class="p">[</span><span class="n">i</span><span class="p">:],</span> <span class="n">i</span><span class="p">):</span>
                <span class="n">sign</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">))</span>  <span class="c1"># this sign seems to be an issue in the calculation of</span>
                <span class="n">sp2_flux</span> <span class="o">=</span> <span class="n">sign</span> <span class="o">*</span> <span class="n">rho2</span> <span class="o">*</span> <span class="p">(</span><span class="n">com_vel</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">tot_com_vel</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">no_dim</span><span class="p">):</span>
                    <span class="n">jc_acf</span><span class="p">[</span><span class="n">indx</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">correlationfunction_1D</span><span class="p">(</span><span class="n">sp1_flux</span><span class="p">[</span><span class="n">d</span><span class="p">,</span> <span class="p">:],</span> <span class="n">sp2_flux</span><span class="p">[</span><span class="n">d</span><span class="p">,</span> <span class="p">:])</span>

                <span class="n">jc_acf</span><span class="p">[</span><span class="n">indx</span><span class="p">,</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">correlationfunction</span><span class="p">(</span><span class="n">sp1_flux</span><span class="p">,</span> <span class="n">sp2_flux</span><span class="p">)</span>
                <span class="n">indx</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">jc_acf</span></div>


<div class="viewcode-block" id="calc_vacf"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.calc_vacf">[docs]</a><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">calc_vacf</span><span class="p">(</span><span class="n">vel</span><span class="p">,</span> <span class="n">sp_num</span><span class="p">,</span> <span class="n">time_averaging</span><span class="p">,</span> <span class="n">it_skip</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the velocity autocorrelation function of each species and in each direction.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    time_averaging: bool</span>
<span class="sd">        Flag for time averaging.</span>

<span class="sd">    it_skip: int</span>
<span class="sd">        Timestep interval for time averaging.</span>

<span class="sd">    vel : numpy.ndarray</span>
<span class="sd">        Particles&#39; velocities stored in a 3D array with shape D x Np x Nt. D = cartesian dimensions,</span>
<span class="sd">        Np = Number of particles, Nt = number of dumps.</span>

<span class="sd">    sp_num: numpy.ndarray</span>
<span class="sd">        Number of particles of each species.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    vacf: numpy.ndarray</span>
<span class="sd">        Velocity autocorrelation functions.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">no_dim</span> <span class="o">=</span> <span class="n">vel</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">no_dumps</span> <span class="o">=</span> <span class="n">vel</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">vacf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">sp_num</span><span class="p">),</span> <span class="n">no_dim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">no_dumps</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">time_averaging</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">no_dim</span><span class="p">):</span>
            <span class="n">vacf_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">no_dumps</span><span class="p">)</span>
            <span class="n">norm_counter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">no_dumps</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">ptcl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sp_num</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">no_dumps</span><span class="p">,</span> <span class="n">it_skip</span><span class="p">):</span>
                    <span class="n">vacf_temp</span><span class="p">[:</span> <span class="n">no_dumps</span> <span class="o">-</span> <span class="n">it</span><span class="p">]</span> <span class="o">+=</span> <span class="n">autocorrelationfunction_1D</span><span class="p">(</span><span class="n">vel</span><span class="p">[</span><span class="n">d</span><span class="p">,</span> <span class="n">ptcl</span><span class="p">,</span> <span class="n">it</span><span class="p">:])</span>
                    <span class="n">norm_counter</span><span class="p">[:</span> <span class="n">no_dumps</span> <span class="o">-</span> <span class="n">it</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>

            <span class="n">vacf</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">vacf_temp</span> <span class="o">/</span> <span class="n">norm_counter</span>

        <span class="n">vacf_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">no_dumps</span><span class="p">)</span>
        <span class="n">norm_counter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">no_dumps</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ptcl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sp_num</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">no_dumps</span><span class="p">,</span> <span class="n">it_skip</span><span class="p">):</span>
                <span class="n">vacf_temp</span><span class="p">[:</span> <span class="n">no_dumps</span> <span class="o">-</span> <span class="n">it</span><span class="p">]</span> <span class="o">+=</span> <span class="n">autocorrelationfunction</span><span class="p">(</span><span class="n">vel</span><span class="p">[:,</span> <span class="n">ptcl</span><span class="p">,</span> <span class="n">it</span><span class="p">:])</span>
                <span class="n">norm_counter</span><span class="p">[:</span> <span class="n">no_dumps</span> <span class="o">-</span> <span class="n">it</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>

        <span class="n">vacf</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">vacf_temp</span> <span class="o">/</span> <span class="n">norm_counter</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Calculate the vacf of each species in each dimension</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">no_dim</span><span class="p">):</span>
            <span class="n">vacf_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">no_dumps</span><span class="p">)</span>
            <span class="n">sp_start</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">sp_end</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">sp</span><span class="p">,</span> <span class="n">n_sp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sp_num</span><span class="p">):</span>
                <span class="n">sp_end</span> <span class="o">+=</span> <span class="n">n_sp</span>
                <span class="k">for</span> <span class="n">ptcl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sp_start</span><span class="p">,</span> <span class="n">sp_end</span><span class="p">):</span>
                    <span class="n">vacf_temp</span> <span class="o">+=</span> <span class="n">autocorrelationfunction_1D</span><span class="p">(</span><span class="n">vel</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">ptcl</span><span class="p">,</span> <span class="p">:])</span>
                <span class="n">vacf</span><span class="p">[</span><span class="n">sp</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">vacf_temp</span> <span class="o">/</span> <span class="n">n_sp</span>
                <span class="n">sp_start</span> <span class="o">=</span> <span class="n">sp_end</span>

        <span class="n">vacf_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">no_dumps</span><span class="p">)</span>
        <span class="n">sp_start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">sp_end</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">sp</span><span class="p">,</span> <span class="n">n_sp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sp_num</span><span class="p">):</span>
            <span class="n">sp_end</span> <span class="o">+=</span> <span class="n">n_sp</span>
            <span class="k">for</span> <span class="n">ptcl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sp_start</span><span class="p">,</span> <span class="n">sp_end</span><span class="p">):</span>
                <span class="n">vacf_temp</span> <span class="o">+=</span> <span class="n">autocorrelationfunction</span><span class="p">(</span><span class="n">vel</span><span class="p">[:,</span> <span class="n">ptcl</span><span class="p">,</span> <span class="p">:])</span>
            <span class="n">vacf</span><span class="p">[</span><span class="n">sp</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">vacf_temp</span> <span class="o">/</span> <span class="n">n_sp</span>
            <span class="n">sp_start</span> <span class="o">=</span> <span class="n">sp_end</span>

    <span class="k">return</span> <span class="n">vacf</span></div>


<div class="viewcode-block" id="calc_vk"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.calc_vk">[docs]</a><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">calc_vk</span><span class="p">(</span><span class="n">pos_data</span><span class="p">,</span> <span class="n">vel_data</span><span class="p">,</span> <span class="n">k_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the instantaneous longitudinal and transverse velocity fluctuations.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pos_data : numpy.ndarray</span>
<span class="sd">        Particles&#39; position. Shape = ( ``no_dumps``, 3, ``tot_no_ptcls``)</span>

<span class="sd">    vel_data : numpy.ndarray</span>
<span class="sd">        Particles&#39; velocities. Shape = ( ``no_dumps``, 3, ``tot_no_ptcls``)</span>

<span class="sd">    k_list : list</span>
<span class="sd">        List of :math:`k` indices in each direction with corresponding magnitude and index of ``ka_counts``.</span>
<span class="sd">        Shape=(``no_ka_values``, 5)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    vkt : numpy.ndarray</span>
<span class="sd">        Array containing longitudinal velocity fluctuations.</span>

<span class="sd">    vkt_i : numpy.ndarray</span>
<span class="sd">        Array containing transverse velocity fluctuations in the :math:`x` direction.</span>

<span class="sd">    vkt_j : numpy.ndarray</span>
<span class="sd">        Array containing transverse velocity fluctuations in the :math:`y` direction.</span>

<span class="sd">    vkt_k : numpy.ndarray</span>
<span class="sd">        Array containing transverse velocity fluctuations in the :math:`z` direction.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Longitudinal</span>
    <span class="n">vk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k_list</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>

    <span class="c1"># Transverse</span>
    <span class="n">vk_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k_list</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
    <span class="n">vk_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k_list</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
    <span class="n">vk_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k_list</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ik</span><span class="p">,</span> <span class="n">k_vec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">k_list</span><span class="p">):</span>
        <span class="c1"># Calculate the dot product and cross product between k, r, and v</span>
        <span class="n">kr_i</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">k_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">pos_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">k_vec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">pos_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">k_vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">pos_data</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="n">k_dot_v</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">k_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">vel_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">k_vec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">vel_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">k_vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">vel_data</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>

        <span class="n">k_cross_v_i</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">k_vec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">vel_data</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">k_vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">vel_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">k_cross_v_j</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">k_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">vel_data</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">k_vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">vel_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">k_cross_v_k</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">k_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">vel_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">k_vec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">vel_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="c1"># Microscopic longitudinal current</span>
        <span class="n">vk</span><span class="p">[</span><span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">k_dot_v</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">kr_i</span><span class="p">))</span>
        <span class="c1"># Microscopic transverse current</span>
        <span class="n">vk_i</span><span class="p">[</span><span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">k_cross_v_i</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">kr_i</span><span class="p">))</span>
        <span class="n">vk_j</span><span class="p">[</span><span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">k_cross_v_j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">kr_i</span><span class="p">))</span>
        <span class="n">vk_k</span><span class="p">[</span><span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">k_cross_v_k</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">kr_i</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">vk</span><span class="p">,</span> <span class="n">vk_i</span><span class="p">,</span> <span class="n">vk_j</span><span class="p">,</span> <span class="n">vk_k</span></div>


<div class="viewcode-block" id="calc_vkt"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.calc_vkt">[docs]</a><span class="k">def</span> <span class="nf">calc_vkt</span><span class="p">(</span><span class="n">fldr</span><span class="p">,</span> <span class="n">slices</span><span class="p">,</span> <span class="n">dump_step</span><span class="p">,</span> <span class="n">species_np</span><span class="p">,</span> <span class="n">k_list</span><span class="p">,</span> <span class="n">verbose</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the longitudinal and transverse velocities fluctuations of all species.</span>
<span class="sd">    Longitudinal</span>

<span class="sd">    .. math::</span>
<span class="sd">        \lambda_A(\mathbf{k}, t) = \sum_i^{N_A} \mathbf{k} \cdot \mathbf{v}_{i}(t) \exp [ - i \mathbf{k} \cdot \mathbf{r}_{i}(t) ]</span>

<span class="sd">    Transverse</span>

<span class="sd">    .. math::</span>
<span class="sd">        \\tau_A(\mathbf{k}, t) = \sum_i^{N_A} \mathbf{k} \\times \mathbf{v}_{i}(t) \exp [ - i \mathbf{k} \cdot \mathbf{r}_{i}(t) ]</span>

<span class="sd">    where :math:`N_A` is the number of particles of species :math:`A`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fldr : str</span>
<span class="sd">        Name of folder containing particles data.</span>

<span class="sd">    slices : tuple, int</span>
<span class="sd">        Initial, final step number of the slice, number of steps per slice.</span>

<span class="sd">    dump_step : int</span>
<span class="sd">        Timestep interval saving.</span>

<span class="sd">    species_np : numpy.ndarray</span>
<span class="sd">        Number of particles of each species.</span>

<span class="sd">    k_list : list</span>
<span class="sd">        List of :math: `k` vectors.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    vkt : numpy.ndarray, complex</span>
<span class="sd">        Longitudinal velocity fluctuations.</span>
<span class="sd">        Shape = ( ``no_species``, ``no_dumps``, ``no_ka_values``)</span>

<span class="sd">    vkt_perp_i : numpy.ndarray, complex</span>
<span class="sd">        Transverse velocity fluctuations along the :math:`x` axis.</span>
<span class="sd">        Shape = ( ``no_species``, ``no_dumps``, ``no_ka_values``)</span>

<span class="sd">    vkt_perp_j : numpy.ndarray, complex</span>
<span class="sd">        Transverse velocity fluctuations along the :math:`y` axis.</span>
<span class="sd">        Shape = ( ``no_species``, ``no_dumps``, ``no_ka_values``)</span>

<span class="sd">    vkt_perp_k : numpy.ndarray, complex</span>
<span class="sd">        Transverse velocity fluctuations along the :math:`z` axis.</span>
<span class="sd">        Shape = ( ``no_species``, ``no_dumps``, ``no_ka_values``)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Read particles&#39; position for all times</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculating longitudinal and transverse microscopic velocity fluctuations v(k,t).&quot;</span><span class="p">)</span>
    <span class="n">no_dumps</span> <span class="o">=</span> <span class="n">slices</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">vkt_par</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">species_np</span><span class="p">),</span> <span class="n">no_dumps</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">k_list</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
    <span class="n">vkt_perp_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">species_np</span><span class="p">),</span> <span class="n">no_dumps</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">k_list</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
    <span class="n">vkt_perp_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">species_np</span><span class="p">),</span> <span class="n">no_dumps</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">k_list</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
    <span class="n">vkt_perp_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">species_np</span><span class="p">),</span> <span class="n">no_dumps</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">k_list</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">it</span><span class="p">,</span> <span class="n">dump</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">slices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">slices</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dump_step</span><span class="p">),</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">verbose</span><span class="p">)):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">load_from_restart</span><span class="p">(</span><span class="n">fldr</span><span class="p">,</span> <span class="n">dump</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;pos&quot;</span><span class="p">]</span>
        <span class="n">vel</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;vel&quot;</span><span class="p">]</span>
        <span class="n">sp_start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">sp_end</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">species_np</span><span class="p">):</span>
            <span class="n">sp_end</span> <span class="o">+=</span> <span class="n">sp</span>
            <span class="n">vkt_par</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">it</span><span class="p">,</span> <span class="p">:],</span> <span class="n">vkt_perp_i</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">it</span><span class="p">,</span> <span class="p">:],</span> <span class="n">vkt_perp_j</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">it</span><span class="p">,</span> <span class="p">:],</span> <span class="n">vkt_perp_k</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">it</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">calc_vk</span><span class="p">(</span>
                <span class="n">pos</span><span class="p">[</span><span class="n">sp_start</span><span class="p">:</span><span class="n">sp_end</span><span class="p">,</span> <span class="p">:],</span> <span class="n">vel</span><span class="p">[</span><span class="n">sp_start</span><span class="p">:</span><span class="n">sp_end</span><span class="p">],</span> <span class="n">k_list</span><span class="p">)</span>
            <span class="n">sp_start</span> <span class="o">+=</span> <span class="n">sp</span>

    <span class="k">return</span> <span class="n">vkt_par</span><span class="p">,</span> <span class="n">vkt_perp_i</span><span class="p">,</span> <span class="n">vkt_perp_j</span><span class="p">,</span> <span class="n">vkt_perp_k</span></div>


<div class="viewcode-block" id="calculate_herm_coeff"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.calculate_herm_coeff">[docs]</a><span class="k">def</span> <span class="nf">calculate_herm_coeff</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">distribution</span><span class="p">,</span> <span class="n">maxpower</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate Hermite coefficients by integrating the velocity distribution function. That is</span>

<span class="sd">    .. math::</span>
<span class="sd">        a_i = \int_{-\\infty}^{\infty} dv \, He_i(v)f(v)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    v : numpy.ndarray</span>
<span class="sd">        Range of velocities.</span>

<span class="sd">    distribution: numpy.ndarray</span>
<span class="sd">        Velocity histogram.</span>

<span class="sd">    maxpower: int</span>
<span class="sd">        Hermite order</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    coeff: numpy.ndarray</span>
<span class="sd">        Coefficients :math:`a_i`</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">coeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">maxpower</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maxpower</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">hc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">hc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">Hp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polynomial</span><span class="o">.</span><span class="n">hermite_e</span><span class="o">.</span><span class="n">hermeval</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">hc</span><span class="p">)</span>
        <span class="n">coeff</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">distribution</span> <span class="o">*</span> <span class="n">Hp</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">coeff</span></div>


<div class="viewcode-block" id="correlationfunction"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.correlationfunction">[docs]</a><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">correlationfunction</span><span class="p">(</span><span class="n">At</span><span class="p">,</span> <span class="n">Bt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the correlation function :math:`\mathbf{A}(t)` and :math:`\mathbf{B}(t)`</span>

<span class="sd">    .. math::</span>
<span class="sd">        C_{AB}(\\tau) =  \sum_j^D \sum_i^T A_j(t_i)B_j(t_i + \\tau)</span>

<span class="sd">    where :math:`D` (= ``no_dim``) is the number of dimensions and :math:`T` (= ``no_steps``) is the total length</span>
<span class="sd">    of the simulation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    At : numpy.ndarray</span>
<span class="sd">        Observable to correlate. Shape=(``no_dim``, ``no_steps``).</span>

<span class="sd">    Bt : numpy.ndarray</span>
<span class="sd">        Observable to correlate. Shape=(``no_dim``, ``no_steps``).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    CF : numpy.ndarray</span>
<span class="sd">        Correlation function :math:`C_{AB}(\\tau)`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">no_steps</span> <span class="o">=</span> <span class="n">At</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">no_dim</span> <span class="o">=</span> <span class="n">At</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">CF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">no_steps</span><span class="p">)</span>
    <span class="n">Norm_counter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">no_steps</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">no_steps</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">no_dim</span><span class="p">):</span>
            <span class="n">CF</span><span class="p">[:</span> <span class="n">no_steps</span> <span class="o">-</span> <span class="n">it</span><span class="p">]</span> <span class="o">+=</span> <span class="n">At</span><span class="p">[</span><span class="n">dim</span><span class="p">,</span> <span class="n">it</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bt</span><span class="p">[</span><span class="n">dim</span><span class="p">,</span> <span class="n">it</span><span class="p">:</span><span class="n">no_steps</span><span class="p">]</span>
        <span class="n">Norm_counter</span><span class="p">[:</span> <span class="n">no_steps</span> <span class="o">-</span> <span class="n">it</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>

    <span class="k">return</span> <span class="n">CF</span> <span class="o">/</span> <span class="n">Norm_counter</span></div>


<div class="viewcode-block" id="correlationfunction_1D"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.correlationfunction_1D">[docs]</a><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">correlationfunction_1D</span><span class="p">(</span><span class="n">At</span><span class="p">,</span> <span class="n">Bt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the correlation function between :math:`A(t)` and :math:`B(t)`</span>

<span class="sd">    .. math::</span>
<span class="sd">        C_{AB}(\\tau) =  \sum_i^T A(t_i)B(t_i + \\tau)</span>

<span class="sd">    where :math:`T` (= ``no_steps``) is the total length of the simulation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    At : numpy.ndarray</span>
<span class="sd">        Observable to correlate. Shape=(``no_steps``).</span>

<span class="sd">    Bt : numpy.ndarray</span>
<span class="sd">        Observable to correlate. Shape=(``no_steps``).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    CF : numpy.ndarray</span>
<span class="sd">        Correlation function :math:`C_{AB}(\\tau)`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">no_steps</span> <span class="o">=</span> <span class="n">At</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">CF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">no_steps</span><span class="p">)</span>
    <span class="n">Norm_counter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">no_steps</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">no_steps</span><span class="p">):</span>
        <span class="n">CF</span><span class="p">[:</span> <span class="n">no_steps</span> <span class="o">-</span> <span class="n">it</span><span class="p">]</span> <span class="o">+=</span> <span class="n">At</span><span class="p">[</span><span class="n">it</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bt</span><span class="p">[</span><span class="n">it</span><span class="p">:</span><span class="n">no_steps</span><span class="p">]</span>
        <span class="n">Norm_counter</span><span class="p">[:</span> <span class="n">no_steps</span> <span class="o">-</span> <span class="n">it</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>

    <span class="k">return</span> <span class="n">CF</span> <span class="o">/</span> <span class="n">Norm_counter</span></div>


<div class="viewcode-block" id="kspace_setup"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.kspace_setup">[docs]</a><span class="k">def</span> <span class="nf">kspace_setup</span><span class="p">(</span><span class="n">no_ka</span><span class="p">,</span> <span class="n">box_lengths</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate all allowed :math:`k` vectors.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    no_ka : numpy.ndarray</span>
<span class="sd">        Number of harmonics in each direction.</span>

<span class="sd">    box_lengths : numpy.ndarray</span>
<span class="sd">        Length of each box&#39;s side.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    k_arr : list</span>
<span class="sd">        List of all possible :math:`k` vectors with their corresponding magnitudes and indexes.</span>

<span class="sd">    k_counts : numpy.ndarray</span>
<span class="sd">        Number of occurrences of each :math:`k` magnitude.</span>

<span class="sd">    k_unique : numpy.ndarray</span>
<span class="sd">        Magnitude of each allowed :math:`k` vector.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Obtain all possible permutations of the wave number arrays</span>
    <span class="n">k_arr</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="o">/</span> <span class="n">box_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">j</span> <span class="o">/</span> <span class="n">box_lengths</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">k</span> <span class="o">/</span> <span class="n">box_lengths</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">no_ka</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
             <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">no_ka</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
             <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">no_ka</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>

    <span class="c1"># Compute wave number magnitude - don&#39;t use |k| (skipping first entry in k_arr)</span>
    <span class="n">k_mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k_arr</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>

    <span class="c1"># Add magnitude to wave number array</span>
    <span class="n">k_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">k_arr</span><span class="p">,</span> <span class="n">k_mag</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Sort from lowest to highest magnitude</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">k_arr</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">k_arr</span> <span class="o">=</span> <span class="n">k_arr</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>

    <span class="c1"># Count how many times a |k| value appears</span>
    <span class="n">k_unique</span><span class="p">,</span> <span class="n">k_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">k_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Generate a 1D array containing index to be used in S array</span>
    <span class="n">k_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k_counts</span><span class="p">)),</span> <span class="n">k_counts</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

    <span class="c1"># Add index to k_array</span>
    <span class="n">k_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">k_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:],</span> <span class="n">k_index</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">k_arr</span><span class="p">,</span> <span class="n">k_counts</span><span class="p">,</span> <span class="n">k_unique</span></div>


<div class="viewcode-block" id="load_from_restart"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.load_from_restart">[docs]</a><span class="k">def</span> <span class="nf">load_from_restart</span><span class="p">(</span><span class="n">fldr</span><span class="p">,</span> <span class="n">it</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load particles&#39; data from dumps.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fldr : str</span>
<span class="sd">        Folder containing dumps.</span>

<span class="sd">    it : int</span>
<span class="sd">        Timestep to load.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    data : dict</span>
<span class="sd">        Particles&#39; data.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fldr</span><span class="p">,</span> <span class="s2">&quot;checkpoint_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.npz&quot;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="plot_labels"><a class="viewcode-back" href="../../../api/sarkas.tools.observables.html#sarkas.tools.observables.plot_labels">[docs]</a><span class="k">def</span> <span class="nf">plot_labels</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">xlbl</span><span class="p">,</span> <span class="n">ylbl</span><span class="p">,</span> <span class="n">units</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create plot labels with correct units and prefixes.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xdata: numpy.ndarray</span>
<span class="sd">        X values.</span>

<span class="sd">    ydata: numpy.ndarray</span>
<span class="sd">        Y values.</span>

<span class="sd">    xlbl: str</span>
<span class="sd">        String of the X quantity.</span>

<span class="sd">    ylbl: str</span>
<span class="sd">        String of the Y quantity.</span>

<span class="sd">    units: str</span>
<span class="sd">        &#39;cgs&#39; or &#39;mks&#39;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    xmultiplier: float</span>
<span class="sd">        Scaling factor for X data.</span>

<span class="sd">    ymultiplier: float</span>
<span class="sd">        Scaling factor for Y data.</span>

<span class="sd">    xprefix: str</span>
<span class="sd">        Prefix for X units label</span>

<span class="sd">    yprefix: str</span>
<span class="sd">         Prefix for Y units label.</span>

<span class="sd">    xlabel: str</span>
<span class="sd">        X label units.</span>

<span class="sd">    ylabel: str</span>
<span class="sd">        Y label units.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span><span class="p">)):</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">xdata</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">xdata</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ydata</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span><span class="p">)):</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">ydata</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">ydata</span>

    <span class="c1"># Find the correct Units</span>
    <span class="n">units_dict</span> <span class="o">=</span> <span class="n">UNITS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;cgs&#39;</span> <span class="k">else</span> <span class="n">UNITS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;cgs&#39;</span> <span class="ow">and</span> <span class="n">xlbl</span> <span class="o">==</span> <span class="s1">&#39;Length&#39;</span><span class="p">:</span>
        <span class="n">xmax</span> <span class="o">*=</span> <span class="mf">1e2</span>

    <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;cgs&#39;</span> <span class="ow">and</span> <span class="n">ylbl</span> <span class="o">==</span> <span class="s1">&#39;Length&#39;</span><span class="p">:</span>
        <span class="n">ymax</span> <span class="o">*=</span> <span class="mf">1e2</span>

    <span class="n">x_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">format_float_scientific</span><span class="p">(</span><span class="n">xmax</span><span class="p">)</span>
    <span class="n">y_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">format_float_scientific</span><span class="p">(</span><span class="n">ymax</span><span class="p">)</span>

    <span class="n">x_exp</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x_str</span><span class="p">[</span><span class="n">x_str</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]))</span>
    <span class="n">y_exp</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">y_str</span><span class="p">[</span><span class="n">y_str</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]))</span>

    <span class="c1"># find the prefix</span>
    <span class="n">xprefix</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
    <span class="n">xmul</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.5</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="k">while</span> <span class="n">xmul</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">*=</span> <span class="mf">10.</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">PREFIXES</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ratio</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">x_exp</span> <span class="o">/</span> <span class="n">value</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ratio</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0e-6</span><span class="p">:</span>
                <span class="n">xprefix</span> <span class="o">=</span> <span class="n">key</span>
                <span class="n">xmul</span> <span class="o">=</span> <span class="n">i</span> <span class="o">/</span> <span class="n">value</span>

    <span class="c1"># find the prefix</span>
    <span class="n">yprefix</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
    <span class="n">ymul</span> <span class="o">=</span> <span class="o">-</span> <span class="mf">1.5</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">while</span> <span class="n">ymul</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">PREFIXES</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ratio</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">y_exp</span> <span class="o">/</span> <span class="n">value</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ratio</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0e-6</span><span class="p">:</span>
                <span class="n">yprefix</span> <span class="o">=</span> <span class="n">key</span>
                <span class="n">ymul</span> <span class="o">=</span> <span class="n">i</span> <span class="o">/</span> <span class="n">value</span>
        <span class="n">i</span> <span class="o">*=</span> <span class="mf">10.</span>

    <span class="k">if</span> <span class="s2">&quot;Energy&quot;</span> <span class="ow">in</span> <span class="n">ylbl</span><span class="p">:</span>
        <span class="n">yname</span> <span class="o">=</span> <span class="s2">&quot;Energy&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">yname</span> <span class="o">=</span> <span class="n">ylbl</span>

    <span class="k">if</span> <span class="s2">&quot;Pressure&quot;</span> <span class="ow">in</span> <span class="n">ylbl</span><span class="p">:</span>
        <span class="n">yname</span> <span class="o">=</span> <span class="s2">&quot;Pressure&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">yname</span> <span class="o">=</span> <span class="n">ylbl</span>

    <span class="k">if</span> <span class="n">yname</span> <span class="ow">in</span> <span class="n">units_dict</span><span class="p">:</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39; [&#39;</span> <span class="o">+</span> <span class="n">yprefix</span> <span class="o">+</span> <span class="n">units_dict</span><span class="p">[</span><span class="n">yname</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">if</span> <span class="s2">&quot;Energy&quot;</span> <span class="ow">in</span> <span class="n">xlbl</span><span class="p">:</span>
        <span class="n">xname</span> <span class="o">=</span> <span class="s2">&quot;Energy&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xname</span> <span class="o">=</span> <span class="n">xlbl</span>

    <span class="k">if</span> <span class="s2">&quot;Pressure&quot;</span> <span class="ow">in</span> <span class="n">xlbl</span><span class="p">:</span>
        <span class="n">xname</span> <span class="o">=</span> <span class="s2">&quot;Pressure&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xname</span> <span class="o">=</span> <span class="n">xlbl</span>

    <span class="k">if</span> <span class="n">xname</span> <span class="ow">in</span> <span class="n">units_dict</span><span class="p">:</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39; [&#39;</span> <span class="o">+</span> <span class="n">xprefix</span> <span class="o">+</span> <span class="n">units_dict</span><span class="p">[</span><span class="n">xname</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">return</span> <span class="n">xmul</span><span class="p">,</span> <span class="n">ymul</span><span class="p">,</span> <span class="n">xprefix</span><span class="p">,</span> <span class="n">yprefix</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020,MurilloGroup
      <span class="lastupdated">
        Last updated on Jan, 27, 2021.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #18453b;
    }
    /* Sidebar */
    .wy-nav-side {
      background: #535054;
    }
    .wy-menu-vertical p.caption {
	  color: #fff;
	}
	.wy-menu-vertical a {
	  color: #eee;
	}
	.wy-menu-vertical a:hover {
    background-color: #18453b;
  }
/*  .wy-nav-content {
    max-width: 900px !important;
  }*/
}
  </style>


</body>
</html>